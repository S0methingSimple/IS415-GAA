<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jeffery Lau">
<meta name="dcterms.date" content="2024-10-13">
<meta name="description" content="In this exercise, we will be looking prototyping for my team’s Geospatial Analytics Shiny Application. I am responsible for">

<title>Jeff’s 🗺 Adventures - Take-home Exercise 3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Jeff’s 🗺 Adventures</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-on Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercise">    
        <li>
    <a class="dropdown-item" href="../../hands-on_ex/ex01/ho_ex01.html">
 <span class="dropdown-text">Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hands-on_ex/ex02/ho_ex02.html">
 <span class="dropdown-text">Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hands-on_ex/ex03/ho_ex03.html">
 <span class="dropdown-text">Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hands-on_ex/ex04/ho_ex04.html">
 <span class="dropdown-text">Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hands-on_ex/ex05/ho_ex05.html">
 <span class="dropdown-text">Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hands-on_ex/ex06/ho_ex06.html">
 <span class="dropdown-text">Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hands-on_ex/ex07/ho_ex07.html">
 <span class="dropdown-text">Exercise 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hands-on_ex/ex08/ho_ex08.html">
 <span class="dropdown-text">Exercise 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hands-on_ex/ex11/ho_ex11.html">
 <span class="dropdown-text">Exercise 11</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In-class Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercise">    
        <li>
    <a class="dropdown-item" href="../../in-class_ex/ex01/ic_ex01.html">
 <span class="dropdown-text">Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in-class_ex/ex02/ic_ex02.html">
 <span class="dropdown-text">Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in-class_ex/ex03/ic_ex03.html">
 <span class="dropdown-text">Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in-class_ex/ex04/ic_ex04.html">
 <span class="dropdown-text">Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in-class_ex/ex05/ic_ex05.html">
 <span class="dropdown-text">Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in-class_ex/ex06/ic_ex06.html">
 <span class="dropdown-text">Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in-class_ex/ex09/ic_ex09.html">
 <span class="dropdown-text">Exercise 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in-class_ex/ex10/ic_ex10.html">
 <span class="dropdown-text">Exercise 10</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Take-home Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercise">    
        <li>
    <a class="dropdown-item" href="../../take-home_ex/ex01/th_ex01.html">
 <span class="dropdown-text">Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../take-home_ex/ex02/th_ex02.html">
 <span class="dropdown-text">Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../take-home_ex/ex03/th_ex03.html">
 <span class="dropdown-text">Exercise 3</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">1. Introduction</a>
  <ul class="collapse">
  <li><a href="#responsibility" id="toc-responsibility" class="nav-link" data-scroll-target="#responsibility">1.1 Responsibility</a></li>
  <li><a href="#motivation" id="toc-motivation" class="nav-link" data-scroll-target="#motivation">1.2 Motivation</a></li>
  <li><a href="#objectives" id="toc-objectives" class="nav-link" data-scroll-target="#objectives">1.3 Objectives</a></li>
  </ul></li>
  <li><a href="#packages-and-data" id="toc-packages-and-data" class="nav-link" data-scroll-target="#packages-and-data">2. Packages and Data</a>
  <ul class="collapse">
  <li><a href="#packages-required" id="toc-packages-required" class="nav-link" data-scroll-target="#packages-required">2.1 Packages Required</a></li>
  <li><a href="#data-required" id="toc-data-required" class="nav-link" data-scroll-target="#data-required">2.2 Data Required</a></li>
  <li><a href="#wrangling" id="toc-wrangling" class="nav-link" data-scroll-target="#wrangling">2.3 Wrangling</a>
  <ul class="collapse">
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">2.3.1 Data Preparation</a></li>
  <li><a href="#checking-for-mismatch-state" id="toc-checking-for-mismatch-state" class="nav-link" data-scroll-target="#checking-for-mismatch-state">2.3.2 Checking for Mismatch (State)</a></li>
  <li><a href="#cleaning-state" id="toc-cleaning-state" class="nav-link" data-scroll-target="#cleaning-state">2.3.3 Cleaning (State)</a></li>
  <li><a href="#crime-state-district" id="toc-crime-state-district" class="nav-link" data-scroll-target="#crime-state-district">2.3.4 Crime (State-District)</a></li>
  <li><a href="#population-state-district" id="toc-population-state-district" class="nav-link" data-scroll-target="#population-state-district">2.3.5 Population (State-District)</a></li>
  <li><a href="#joining" id="toc-joining" class="nav-link" data-scroll-target="#joining">2.3.6 Joining</a></li>
  <li><a href="#visualizing-the-distribution-of-crime" id="toc-visualizing-the-distribution-of-crime" class="nav-link" data-scroll-target="#visualizing-the-distribution-of-crime">2.3.7 Visualizing the distribution of crime</a></li>
  <li><a href="#correlation-plot" id="toc-correlation-plot" class="nav-link" data-scroll-target="#correlation-plot">2.3.8 Correlation Plot</a></li>
  </ul></li>
  <li><a href="#data-enrichment" id="toc-data-enrichment" class="nav-link" data-scroll-target="#data-enrichment">2.4 Data Enrichment</a>
  <ul class="collapse">
  <li><a href="#clearning-state" id="toc-clearning-state" class="nav-link" data-scroll-target="#clearning-state">2.4.1 Clearning (State)</a></li>
  <li><a href="#poverty-inequaltiy-state-district" id="toc-poverty-inequaltiy-state-district" class="nav-link" data-scroll-target="#poverty-inequaltiy-state-district">2.4.2 Poverty &amp; Inequaltiy (State-District)</a></li>
  <li><a href="#wrangling-labour" id="toc-wrangling-labour" class="nav-link" data-scroll-target="#wrangling-labour">2.4.3 Wrangling Labour</a></li>
  <li><a href="#joining-1" id="toc-joining-1" class="nav-link" data-scroll-target="#joining-1">2.4.4 Joining</a></li>
  </ul></li>
  <li><a href="#data-selection" id="toc-data-selection" class="nav-link" data-scroll-target="#data-selection">2.5 Data Selection</a>
  <ul class="collapse">
  <li><a href="#visualizing-the-correlation-of-data" id="toc-visualizing-the-correlation-of-data" class="nav-link" data-scroll-target="#visualizing-the-correlation-of-data">2.5.1 Visualizing the Correlation of Data</a></li>
  <li><a href="#final-selection" id="toc-final-selection" class="nav-link" data-scroll-target="#final-selection">2.5.2 Final Selection</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#analysis" id="toc-analysis" class="nav-link" data-scroll-target="#analysis">3. Analysis</a>
  <ul class="collapse">
  <li><a href="#data-standardisation" id="toc-data-standardisation" class="nav-link" data-scroll-target="#data-standardisation">3.1 Data Standardisation</a></li>
  <li><a href="#exploratory-data-analysis-eda" id="toc-exploratory-data-analysis-eda" class="nav-link" data-scroll-target="#exploratory-data-analysis-eda">3.2 Exploratory Data Analysis (EDA)</a></li>
  <li><a href="#hierarchical-clustering" id="toc-hierarchical-clustering" class="nav-link" data-scroll-target="#hierarchical-clustering">3.3 Hierarchical Clustering</a></li>
  <li><a href="#skater-clustering" id="toc-skater-clustering" class="nav-link" data-scroll-target="#skater-clustering">3.4 SKATER Clustering</a>
  <ul class="collapse">
  <li><a href="#fixing" id="toc-fixing" class="nav-link" data-scroll-target="#fixing">3.3.2 Fixing</a></li>
  <li><a href="#compute-mst" id="toc-compute-mst" class="nav-link" data-scroll-target="#compute-mst">3.3.3 Compute MST</a></li>
  <li><a href="#compute-clusters-skater" id="toc-compute-clusters-skater" class="nav-link" data-scroll-target="#compute-clusters-skater">3.3.4 Compute clusters (SKATER)</a></li>
  <li><a href="#visualizing-clusters" id="toc-visualizing-clusters" class="nav-link" data-scroll-target="#visualizing-clusters">3.3.5 Visualizing Clusters</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#intepretation" id="toc-intepretation" class="nav-link" data-scroll-target="#intepretation">4. Intepretation</a></li>
  <li><a href="#story-board" id="toc-story-board" class="nav-link" data-scroll-target="#story-board">5. Story Board</a>
  <ul class="collapse">
  <li><a href="#layout" id="toc-layout" class="nav-link" data-scroll-target="#layout">5.1 Layout</a></li>
  <li><a href="#parameters" id="toc-parameters" class="nav-link" data-scroll-target="#parameters">5.2 Parameters</a></li>
  </ul></li>
  <li><a href="#reflection" id="toc-reflection" class="nav-link" data-scroll-target="#reflection">6. Reflection</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take-home Exercise 3</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Take-home</div>
  </div>
  </div>

<div>
  <div class="description">
    <p>In this exercise, we will be looking prototyping for my team’s Geospatial Analytics Shiny Application. I am responsible for</p>
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jeffery Lau </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 13, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">November 1, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>1. Introduction</h1>
<section id="responsibility" class="level2">
<h2 class="anchored" data-anchor-id="responsibility">1.1 Responsibility</h2>
</section>
<section id="motivation" class="level2">
<h2 class="anchored" data-anchor-id="motivation">1.2 Motivation</h2>
</section>
<section id="objectives" class="level2">
<h2 class="anchored" data-anchor-id="objectives">1.3 Objectives</h2>
</section>
</section>
<section id="packages-and-data" class="level1">
<h1>2. Packages and Data</h1>
<section id="packages-required" class="level2">
<h2 class="anchored" data-anchor-id="packages-required">2.1 Packages Required</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf, st, tidyverse, raster, tmap, tmaptools, ggplot2, spatstat, sfdep, spdep, ClustGeo, </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>               ggpubr, cluster, factoextra, NbClust,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>               heatmaply, corrplot, psych, tidyverse, GGally)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-required" class="level2">
<h2 class="anchored" data-anchor-id="data-required">2.2 Data Required</h2>
<p>There are two datasets being used in this exercise.</p>
<ul>
<li><p><a href="https://data.gov.my/data-catalogue/crime_district">Malaysia – Crime by District and Crime Type</a> from data.gov.my in csv format.</p></li>
<li><p><a href="https://data.humdata.org/dataset/cod-ab-mys">Malaysia - Subnational Administrative Boundaries</a> with included administrative regions in shapefile format.</p></li>
<li><p><a href="https://data.gov.my/data-catalogue/lfs_district">Malaysia – Annual Principal Labour Force Statistics by District</a> from data.gov.my in csv format.</p></li>
<li><p><a href="https://data.gov.my/data-catalogue/hies_district">Malaysia – Household Income and Expenditure: Administrative Districts</a> from data.gov.my in csv format.</p></li>
<li><p><a href="https://data.gov.my/data-catalogue/enrolment_school_district">Malaysia – Enrolment in Government Schools by District</a> from data.gov.my in csv format.</p></li>
<li><p><a href="https://data.gov.my/data-catalogue/enrolment_school_district">Malaysia – Enrolment in Government Schools by District</a> from data.gov.my in csv format.</p></li>
</ul>
<p>We first import the crime rate csv file into R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>crime_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/crime_district.csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>population_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/population_district.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we import the administrative regions of Malaysia.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>mys_sf <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial/mys_adm_unhcr_20210211_shp"</span>, </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">layer =</span> <span class="st">"mys_admbnda_adm2_unhcr_20210211"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3168</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="wrangling" class="level2">
<h2 class="anchored" data-anchor-id="wrangling">2.3 Wrangling</h2>
<section id="data-preparation" class="level3">
<h3 class="anchored" data-anchor-id="data-preparation">2.3.1 Data Preparation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Unique states in crime_df:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Unique states in crime_df:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(crime_df<span class="sc">$</span>state)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Malaysia"          "Johor"             "Kedah"            
 [4] "Kelantan"          "Melaka"            "Negeri Sembilan"  
 [7] "Pahang"            "Perak"             "Perlis"           
[10] "Pulau Pinang"      "Sabah"             "Sarawak"          
[13] "Selangor"          "Terengganu"        "W.P. Kuala Lumpur"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Unique states in population_df:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Unique states in population_df:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(crime_df<span class="sc">$</span>state)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Malaysia"          "Johor"             "Kedah"            
 [4] "Kelantan"          "Melaka"            "Negeri Sembilan"  
 [7] "Pahang"            "Perak"             "Perlis"           
[10] "Pulau Pinang"      "Sabah"             "Sarawak"          
[13] "Selangor"          "Terengganu"        "W.P. Kuala Lumpur"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Unique states in mys_sf:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Unique states in mys_sf:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(mys_sf<span class="sc">$</span>ADM1_EN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Johor"             "Kedah"             "Kelantan"         
 [4] "W.P. Kuala Lumpur" "W.P. Labuan"       "Melaka"           
 [7] "Negeri Sembilan"   "Pahang"            "Perak"            
[10] "Perlis"            "Pulau Pinang"      "Sabah"            
[13] "Sarawak"           "Terengganu"        "W.P. Putrajaya"   
[16] "Selangor"         </code></pre>
</div>
</div>
<p>Convert state and district to upper for matching</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>crime_df <span class="ot">&lt;-</span> crime_df <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(date),</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">state =</span> <span class="fu">toupper</span>(state),</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">district =</span> <span class="fu">toupper</span>(district))</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>crime_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 19,152 × 7
   state    district category type           date       crimes  year
   &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;          &lt;date&gt;      &lt;dbl&gt; &lt;dbl&gt;
 1 MALAYSIA ALL      assault  all            2016-01-01  22327  2016
 2 MALAYSIA ALL      assault  all            2017-01-01  21366  2017
 3 MALAYSIA ALL      assault  all            2018-01-01  16902  2018
 4 MALAYSIA ALL      assault  all            2019-01-01  16489  2019
 5 MALAYSIA ALL      assault  all            2020-01-01  13279  2020
 6 MALAYSIA ALL      assault  all            2021-01-01  11495  2021
 7 MALAYSIA ALL      assault  all            2022-01-01  10348  2022
 8 MALAYSIA ALL      assault  all            2023-01-01  10453  2023
 9 MALAYSIA ALL      assault  causing_injury 2016-01-01   5531  2016
10 MALAYSIA ALL      assault  causing_injury 2017-01-01   5024  2017
# ℹ 19,142 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>population_df <span class="ot">&lt;-</span> population_df <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(date),</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">state =</span> <span class="fu">toupper</span>(state),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">district =</span> <span class="fu">toupper</span>(district))</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>population_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 319,200 × 8
   state district   date       sex   age     ethnicity        population  year
   &lt;chr&gt; &lt;chr&gt;      &lt;date&gt;     &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt;
 1 JOHOR BATU PAHAT 2020-01-01 both  overall overall               495.   2020
 2 JOHOR BATU PAHAT 2020-01-01 both  overall bumi_malay            311.   2020
 3 JOHOR BATU PAHAT 2020-01-01 both  overall bumi_other              5.1  2020
 4 JOHOR BATU PAHAT 2020-01-01 both  overall chinese               140.   2020
 5 JOHOR BATU PAHAT 2020-01-01 both  overall indian                  6.9  2020
 6 JOHOR BATU PAHAT 2020-01-01 both  overall other_citizen           1.8  2020
 7 JOHOR BATU PAHAT 2020-01-01 both  overall other_noncitizen       30.2  2020
 8 JOHOR BATU PAHAT 2020-01-01 both  0-4     overall                30.3  2020
 9 JOHOR BATU PAHAT 2020-01-01 both  0-4     bumi_malay             21.3  2020
10 JOHOR BATU PAHAT 2020-01-01 both  0-4     bumi_other              0.5  2020
# ℹ 319,190 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>mys_sf <span class="ot">&lt;-</span> mys_sf <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">ADM1_EN =</span> <span class="fu">toupper</span>(ADM1_EN),</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ADM2_EN =</span> <span class="fu">toupper</span>(ADM2_EN))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>mys_sf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 144 features and 14 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 184853.1 ymin: 94420.8 xmax: 2380932 ymax: 829136
Projected CRS: Kertau (RSO) / RSO Malaya (m)
# A tibble: 144 × 15
   ADM2_EN  ADM2_PCODE ADM2_REF ADM2ALT1EN ADM2ALT2EN ADM1_EN ADM1_PCODE ADM0_EN
 * &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;  
 1 BATU PA… MY0101     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malays…
 2 JOHOR B… MY0102     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malays…
 3 KLUANG   MY0103     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malays…
 4 KOTA TI… MY0104     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malays…
 5 KULAIJA… MY0105     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malays…
 6 LEDANG   MY0106     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malays…
 7 MERSING  MY0107     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malays…
 8 MUAR     MY0108     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malays…
 9 PONTIAN  MY0109     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malays…
10 SEGAMAT  MY0110     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malays…
# ℹ 134 more rows
# ℹ 7 more variables: ADM0_PCODE &lt;chr&gt;, date &lt;date&gt;, validOn &lt;date&gt;,
#   validTo &lt;date&gt;, Shape_Leng &lt;dbl&gt;, Shape_Area &lt;dbl&gt;,
#   geometry &lt;MULTIPOLYGON [m]&gt;</code></pre>
</div>
</div>
</section>
<section id="checking-for-mismatch-state" class="level3">
<h3 class="anchored" data-anchor-id="checking-for-mismatch-state">2.3.2 Checking for Mismatch (State)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming you have two character vectors:</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>state_crime <span class="ot">&lt;-</span> <span class="fu">unique</span>(crime_df<span class="sc">$</span>state)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>state_sf <span class="ot">&lt;-</span> <span class="fu">unique</span>(mys_sf<span class="sc">$</span>ADM1_EN)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Find states in crime_df that are not in mys_sf</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>missing_in_sf <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(state_crime, state_sf)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Find states in mys_sf that are not in crime_df</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>missing_in_crime <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(state_sf, state_crime)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the mismatches</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"States in crime_df not found in mys_sf:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "States in crime_df not found in mys_sf:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(missing_in_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "MALAYSIA"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"States in mys_sf not found in crime_df:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "States in mys_sf not found in crime_df:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(missing_in_crime)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "W.P. LABUAN"    "W.P. PUTRAJAYA"</code></pre>
</div>
</div>
</section>
<section id="cleaning-state" class="level3">
<h3 class="anchored" data-anchor-id="cleaning-state">2.3.3 Cleaning (State)</h3>
<p>However in this case study, for ease of analysis, we choose to focus on West Malaysia, and thus will be filtering out Sarawak, Sabah and Labuan.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>mys_sf <span class="ot">&lt;-</span> mys_sf <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">filter</span>(ADM1_EN <span class="sc">!=</span> <span class="st">'W.P. LABUAN'</span> <span class="sc">&amp;</span> ADM1_EN <span class="sc">!=</span> <span class="st">'SABAH'</span> <span class="sc">&amp;</span> ADM1_EN <span class="sc">!=</span> <span class="st">'SARAWAK'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">ADM1_EN =</span> <span class="fu">replace</span>(ADM1_EN, ADM1_EN <span class="sc">==</span> <span class="st">'W.P. KUALA LUMPUR'</span>, <span class="st">'KUALA LUMPUR'</span>),</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ADM1_EN =</span> <span class="fu">replace</span>(ADM1_EN, ADM1_EN <span class="sc">==</span> <span class="st">'W.P. PUTRAJAYA'</span>, <span class="st">'KUALA LUMPUR'</span>))</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>mys_sf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 87 features and 14 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 184853.1 ymin: 139843.3 xmax: 728635.8 ymax: 744607.2
Projected CRS: Kertau (RSO) / RSO Malaya (m)
# A tibble: 87 × 15
   ADM2_EN  ADM2_PCODE ADM2_REF ADM2ALT1EN ADM2ALT2EN ADM1_EN ADM1_PCODE ADM0_EN
 * &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;  
 1 BATU PA… MY0101     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malays…
 2 JOHOR B… MY0102     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malays…
 3 KLUANG   MY0103     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malays…
 4 KOTA TI… MY0104     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malays…
 5 KULAIJA… MY0105     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malays…
 6 LEDANG   MY0106     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malays…
 7 MERSING  MY0107     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malays…
 8 MUAR     MY0108     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malays…
 9 PONTIAN  MY0109     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malays…
10 SEGAMAT  MY0110     &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;       JOHOR   MY01       Malays…
# ℹ 77 more rows
# ℹ 7 more variables: ADM0_PCODE &lt;chr&gt;, date &lt;date&gt;, validOn &lt;date&gt;,
#   validTo &lt;date&gt;, Shape_Leng &lt;dbl&gt;, Shape_Area &lt;dbl&gt;,
#   geometry &lt;MULTIPOLYGON [m]&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>crime_df <span class="ot">&lt;-</span> crime_df <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(state <span class="sc">!=</span> <span class="st">'MALAYSIA'</span> <span class="sc">&amp;</span> state <span class="sc">!=</span> <span class="st">'SABAH'</span> <span class="sc">&amp;</span> state <span class="sc">!=</span> <span class="st">'SARAWAK'</span> <span class="sc">&amp;</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>                     district <span class="sc">!=</span> <span class="st">'ALL'</span> <span class="sc">&amp;</span> type <span class="sc">!=</span> <span class="st">'all'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">replace</span>(state, state <span class="sc">==</span> <span class="st">'W.P. KUALA LUMPUR'</span>, <span class="st">'KUALA LUMPUR'</span>))</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>crime_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10,368 × 7
   state district   category type           date       crimes  year
   &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;          &lt;date&gt;      &lt;dbl&gt; &lt;dbl&gt;
 1 JOHOR BATU PAHAT assault  causing_injury 2016-01-01     39  2016
 2 JOHOR BATU PAHAT assault  causing_injury 2017-01-01     41  2017
 3 JOHOR BATU PAHAT assault  causing_injury 2018-01-01     28  2018
 4 JOHOR BATU PAHAT assault  causing_injury 2019-01-01     41  2019
 5 JOHOR BATU PAHAT assault  causing_injury 2020-01-01     43  2020
 6 JOHOR BATU PAHAT assault  causing_injury 2021-01-01     22  2021
 7 JOHOR BATU PAHAT assault  causing_injury 2022-01-01     19  2022
 8 JOHOR BATU PAHAT assault  causing_injury 2023-01-01     22  2023
 9 JOHOR BATU PAHAT assault  murder         2016-01-01      6  2016
10 JOHOR BATU PAHAT assault  murder         2017-01-01      0  2017
# ℹ 10,358 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>population_df <span class="ot">&lt;-</span> population_df <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">filter</span>(state <span class="sc">!=</span> <span class="st">'SABAH'</span> <span class="sc">&amp;</span> state <span class="sc">!=</span> <span class="st">'SARAWAK'</span> <span class="sc">&amp;</span> state <span class="sc">!=</span> <span class="st">'W.P. LABUAN'</span> <span class="sc">&amp;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                 sex <span class="sc">==</span> <span class="st">"both"</span> <span class="sc">&amp;</span> age <span class="sc">==</span> <span class="st">"overall"</span> <span class="sc">&amp;</span> ethnicity <span class="sc">==</span> <span class="st">"overall"</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">replace</span>(state, state <span class="sc">==</span> <span class="st">'W.P. KUALA LUMPUR'</span>, <span class="st">'KUALA LUMPUR'</span>),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">state =</span> <span class="fu">replace</span>(state, state <span class="sc">==</span> <span class="st">'W.P. PUTRAJAYA'</span>, <span class="st">'KUALA LUMPUR'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">select</span>(state, district, year, population)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>population_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 276 × 4
   state district     year population
   &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;
 1 JOHOR BATU PAHAT   2020      495. 
 2 JOHOR JOHOR BAHRU  2020     1711. 
 3 JOHOR KLUANG       2020      324. 
 4 JOHOR KOTA TINGGI  2020      222. 
 5 JOHOR KULAI        2020      330. 
 6 JOHOR MERSING      2020       78.2
 7 JOHOR MUAR         2020      315. 
 8 JOHOR PONTIAN      2020      173. 
 9 JOHOR SEGAMAT      2020      198. 
10 JOHOR TANGKAK      2020      163. 
# ℹ 266 more rows</code></pre>
</div>
</div>
</section>
<section id="crime-state-district" class="level3">
<h3 class="anchored" data-anchor-id="crime-state-district">2.3.4 Crime (State-District)</h3>
<section id="check-for-mismatch" class="level4">
<h4 class="anchored" data-anchor-id="check-for-mismatch">2.3.4.1 Check for Mismatch</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>crime_df <span class="ot">&lt;-</span> crime_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">state_district =</span> <span class="fu">paste</span>(state, district, <span class="at">sep =</span> <span class="st">"-"</span>))</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>mys_sf <span class="ot">&lt;-</span> mys_sf <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">state_district =</span> <span class="fu">paste</span>(ADM1_EN, ADM2_EN, <span class="at">sep =</span> <span class="st">"-"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming you have two character vectors:</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>state_district_crime <span class="ot">&lt;-</span> <span class="fu">unique</span>(crime_df<span class="sc">$</span>state_district)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>state_district_sf <span class="ot">&lt;-</span> <span class="fu">unique</span>(mys_sf<span class="sc">$</span>state_district)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Find mismatches</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>missing_in_sf <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(state_district_crime, state_district_sf)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>missing_in_crime <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(state_district_sf, state_district_crime)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the mismatches</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"State-District combinations in crime_df not found in mys_sf:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "State-District combinations in crime_df not found in mys_sf:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(missing_in_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "JOHOR-ISKANDAR PUTERI"               "JOHOR-JOHOR BAHRU SELATAN"          
 [3] "JOHOR-JOHOR BAHRU UTARA"             "JOHOR-NUSAJAYA"                     
 [5] "JOHOR-SERI ALAM"                     "KEDAH-BANDAR BHARU"                 
 [7] "NEGERI SEMBILAN-NILAI"               "PAHANG-CAMERON HIGHLAND"            
 [9] "PAHANG-KUALA LIPIS"                  "PERAK-BATU GAJAH"                   
[11] "PERAK-GERIK"                         "PERAK-IPOH"                         
[13] "PERAK-MANJUNG"                       "PERAK-PENGKALAN HULU"               
[15] "PERAK-SELAMA"                        "PERAK-SUNGAI SIPUT"                 
[17] "PERAK-TAIPING"                       "PERAK-TANJONG MALIM"                
[19] "PERAK-TAPAH"                         "PERLIS-ARAU"                        
[21] "PERLIS-KANGAR"                       "PERLIS-PADANG BESAR"                
[23] "PULAU PINANG-SEBERANG PERAI SELATAN" "PULAU PINANG-SEBERANG PERAI TENGAH" 
[25] "PULAU PINANG-SEBERANG PERAI UTARA"   "SELANGOR-AMPANG JAYA"               
[27] "SELANGOR-HULU SELANGOR"              "SELANGOR-KAJANG"                    
[29] "SELANGOR-KLANG SELATAN"              "SELANGOR-KLANG UTARA"               
[31] "SELANGOR-PETALING JAYA"              "SELANGOR-SERDANG"                   
[33] "SELANGOR-SG. BULOH"                  "SELANGOR-SHAH ALAM"                 
[35] "SELANGOR-SUBANG JAYA"                "SELANGOR-SUNGAI BULOH"              
[37] "KUALA LUMPUR-BRICKFIELDS"            "KUALA LUMPUR-CHERAS"                
[39] "KUALA LUMPUR-DANG WANGI"             "KUALA LUMPUR-SENTUL"                
[41] "KUALA LUMPUR-WANGSA MAJU"           </code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"State-District combinations in mys_sf not found in crime_df:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "State-District combinations in mys_sf not found in crime_df:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(missing_in_crime)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "JOHOR-JOHOR BAHRU"             "KEDAH-POKOK SENA"             
 [3] "KUALA LUMPUR-WP. KUALA LUMPUR" "PAHANG-LIPIS"                 
 [5] "PERAK-BATANG PADANG"           "PERAK-ULU PERAK"              
 [7] "PERAK-KINTA"                   "PERAK-LARUT DAN MATANG"       
 [9] "PERAK-MANJUNG (DINDING)"       "PERLIS-PERLIS"                
[11] "PULAU PINANG-S.P.SELATAN"      "PULAU PINANG-S.P. TENGAH"     
[13] "PULAU PINANG-S.P. UTARA"       "SELANGOR-ULU LANGAT"          
[15] "SELANGOR-ULU SELANGOR"         "SELANGOR-KLANG"               
[17] "SELANGOR-PETALING"            </code></pre>
</div>
</div>
</section>
<section id="cleaning" class="level4">
<h4 class="anchored" data-anchor-id="cleaning">2.3.4.2 Cleaning</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>crime_df <span class="ot">&lt;-</span> crime_df <span class="sc">%&gt;%</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">district =</span> <span class="fu">case_when</span>(</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"JOHOR"</span> <span class="sc">&amp;</span> district <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"ISKANDAR PUTERI"</span>, <span class="st">"NUSAJAYA"</span>, <span class="st">"JOHOR BAHRU SELATAN"</span>, <span class="st">"JOHOR BAHRU UTARA"</span>, <span class="st">"SERI ALAM"</span>) <span class="sc">~</span> <span class="st">"JOHOR BAHRU"</span>,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"NEGERI SEMBILAN"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"NILAI"</span> <span class="sc">~</span> <span class="st">"SEREMBAN"</span>,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"KEDAH"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"BANDAR BHARU"</span> <span class="sc">~</span> <span class="st">"BANDAR BAHARU"</span>,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PAHANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"CAMERON HIGHLAND"</span> <span class="sc">~</span> <span class="st">"CAMERON HIGHLANDS"</span>,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PAHANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"KUALA LIPIS"</span> <span class="sc">~</span> <span class="st">"LIPIS"</span>,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district  <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"BATU GAJAH"</span>, <span class="st">"IPOH"</span>) <span class="sc">~</span> <span class="st">"KINTA"</span>,</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"GERIK"</span> <span class="sc">~</span> <span class="st">"ULU PERAK"</span>,</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"MANJUNG"</span> <span class="sc">~</span> <span class="st">"MANJUNG (DINDING)"</span>,</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"PENGKALAN HULU"</span> <span class="sc">~</span> <span class="st">"ULU PERAK"</span>,</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"SELAMA"</span>, <span class="st">"TAIPING"</span>) <span class="sc">~</span> <span class="st">"LARUT DAN MATANG"</span>,</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SUNGAI SIPUT"</span> <span class="sc">~</span> <span class="st">"KUALA KANGSAR"</span>,</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"TANJONG MALIM"</span>, <span class="st">"TAPAH"</span>) <span class="sc">~</span> <span class="st">"BATANG PADANG"</span>,</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERLIS"</span> <span class="sc">&amp;</span> district <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"ARAU"</span>, <span class="st">"KANGAR"</span>, <span class="st">"PADANG BESAR"</span>) <span class="sc">~</span> <span class="st">"PERLIS"</span>,</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PULAU PINANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SEBERANG PERAI SELATAN"</span> <span class="sc">~</span> <span class="st">"S.P.SELATAN"</span>,</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PULAU PINANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SEBERANG PERAI TENGAH"</span> <span class="sc">~</span> <span class="st">"S.P. TENGAH"</span>,</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PULAU PINANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SEBERANG PERAI UTARA"</span> <span class="sc">~</span> <span class="st">"S.P. UTARA"</span>,</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"SELANGOR"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"AMPANG JAYA"</span> <span class="sc">~</span> <span class="st">"GOMBAK"</span>,</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"SELANGOR"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"HULU SELANGOR"</span> <span class="sc">~</span> <span class="st">"ULU SELANGOR"</span>,</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"SELANGOR"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"KAJANG"</span> <span class="sc">~</span> <span class="st">"ULU LANGAT"</span>,</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"SELANGOR"</span> <span class="sc">&amp;</span> district <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"KLANG SELATAN"</span>, <span class="st">"KLANG UTARA"</span>) <span class="sc">~</span> <span class="st">"KLANG"</span>,</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"SELANGOR"</span> <span class="sc">&amp;</span> district <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"PETALING JAYA"</span>, <span class="st">"SERDANG"</span>, <span class="st">"SG. BULOH"</span>, <span class="st">"SHAH ALAM"</span>, <span class="st">"SUBANG JAYA"</span>, <span class="st">"SUNGAI BULOH"</span>) <span class="sc">~</span> <span class="st">"PETALING"</span>,</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"KUALA LUMPUR"</span> <span class="sc">&amp;</span> district <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"BRICKFIELDS"</span>, <span class="st">"CHERAS"</span>, <span class="st">"DANG WANGI"</span>, <span class="st">"SENTUL"</span>, <span class="st">"WANGSA MAJU"</span>) <span class="sc">~</span> <span class="st">"WP. KUALA LUMPUR"</span>,</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> district</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state, district, year, category, type) <span class="sc">%&gt;%</span></span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">crimes =</span> <span class="fu">sum</span>(crimes))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mys_sf) <span class="sc">+</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"ADM2_EN"</span>, <span class="at">size =</span> <span class="fl">0.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="th_ex03_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="visualizing-crime-distribution" class="level4">
<h4 class="anchored" data-anchor-id="visualizing-crime-distribution">2.3.4.3 Visualizing Crime Distribution</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>crime_df_mys <span class="ot">&lt;-</span> crime_df <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2019</span> <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mys_sf, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"state"</span> <span class="ot">=</span> <span class="st">"ADM1_EN"</span>, <span class="st">"district"</span> <span class="ot">=</span> <span class="st">"ADM2_EN"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(state, district, year, category, type, crimes, geometry)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>crime_df_mys <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(crime_df_mys)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>crime_df_mys</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 4128 features and 6 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 184853.1 ymin: 139843.3 xmax: 728635.8 ymax: 744607.2
Projected CRS: Kertau (RSO) / RSO Malaya (m)
# A tibble: 4,128 × 7
# Groups:   state, district, year, category [688]
   state district    year category type         crimes                  geometry
   &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;         &lt;dbl&gt;        &lt;MULTIPOLYGON [m]&gt;
 1 JOHOR BATU PAHAT  2019 assault  causing_inj…     41 (((556714.6 192051.6, 55…
 2 JOHOR BATU PAHAT  2019 assault  murder            3 (((556714.6 192051.6, 55…
 3 JOHOR BATU PAHAT  2019 assault  rape             29 (((556714.6 192051.6, 55…
 4 JOHOR BATU PAHAT  2019 assault  robbery_gan…      0 (((556714.6 192051.6, 55…
 5 JOHOR BATU PAHAT  2019 assault  robbery_gan…     37 (((556714.6 192051.6, 55…
 6 JOHOR BATU PAHAT  2019 assault  robbery_sol…      0 (((556714.6 192051.6, 55…
 7 JOHOR BATU PAHAT  2019 assault  robbery_sol…     29 (((556714.6 192051.6, 55…
 8 JOHOR BATU PAHAT  2019 property break_in        157 (((556714.6 192051.6, 55…
 9 JOHOR BATU PAHAT  2019 property theft_other     127 (((556714.6 192051.6, 55…
10 JOHOR BATU PAHAT  2019 property theft_vehic…      4 (((556714.6 192051.6, 55…
# ℹ 4,118 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>crime_df_mys_grp <span class="ot">&lt;-</span> crime_df_mys <span class="sc">%&gt;%</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state, district) <span class="sc">%&gt;%</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_crimes =</span> <span class="fu">sum</span>(crimes))</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>choro <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(crime_df_mys_grp) <span class="sc">+</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"total_crimes"</span>, </span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>, </span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Crimes"</span>) <span class="sc">+</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Distribution of crime in West Malaysia"</span>,</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">1.2</span>,</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.45</span>, </span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>,</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type=</span><span class="st">"8star"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>() <span class="sc">+</span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span><span class="fl">0.2</span>)</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>choro</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="th_ex03_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="population-state-district" class="level3">
<h3 class="anchored" data-anchor-id="population-state-district">2.3.5 Population (State-District)</h3>
<section id="check-for-mismatch-1" class="level4">
<h4 class="anchored" data-anchor-id="check-for-mismatch-1">2.3.5.1 Check for Mismatch</h4>
<p>The year 2019 is missing from data set, hence we will map year 2020 -&gt; 2019.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>population_row <span class="ot">&lt;-</span> population_df <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="dv">2019</span>) </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>population_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(population_df, population_row)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(population_df<span class="sc">$</span>year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2020 2021 2022 2019</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>population_df <span class="ot">&lt;-</span> population_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">state_district =</span> <span class="fu">paste</span>(state, district, <span class="at">sep =</span> <span class="st">"-"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming you have two character vectors:</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>state_district_population <span class="ot">&lt;-</span> <span class="fu">unique</span>(population_df<span class="sc">$</span>state_district)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Find mismatches</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>missing_in_sf <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(state_district_population, state_district_sf)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>missing_in_population <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(state_district_sf, state_district_population)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the mismatches</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"State-District combinations in population_df not found in mys_sf:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "State-District combinations in population_df not found in mys_sf:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(missing_in_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "JOHOR-KULAI"                         "JOHOR-TANGKAK"                      
 [3] "KELANTAN-KECIL LOJING"               "PERAK-BAGAN DATUK"                  
 [5] "PERAK-HULU PERAK"                    "PERAK-MANJUNG"                      
 [7] "PERAK-MUALLIM"                       "PERAK-SELAMA"                       
 [9] "PULAU PINANG-SEBERANG PERAI SELATAN" "PULAU PINANG-SEBERANG PERAI TENGAH" 
[11] "PULAU PINANG-SEBERANG PERAI UTARA"   "TERENGGANU-KUALA NERUS"             
[13] "KUALA LUMPUR-W.P. KUALA LUMPUR"      "PAHANG-CAMERON HIGHLAND"            
[15] "PULAU PINANG-SP SELATAN"             "PULAU PINANG-SP TENGAH"             
[17] "PULAU PINANG-SP UTARA"              </code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"State-District combinations in mys_sf not found in population_df:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "State-District combinations in mys_sf not found in population_df:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(missing_in_population)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "JOHOR-KULAIJAYA"               "JOHOR-LEDANG"                 
[3] "KUALA LUMPUR-WP. KUALA LUMPUR" "PERAK-ULU PERAK"              
[5] "PERAK-MANJUNG (DINDING)"       "PULAU PINANG-S.P.SELATAN"     
[7] "PULAU PINANG-S.P. TENGAH"      "PULAU PINANG-S.P. UTARA"      </code></pre>
</div>
</div>
</section>
<section id="cleaning-1" class="level4">
<h4 class="anchored" data-anchor-id="cleaning-1">2.3.5.2 Cleaning</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>population_df <span class="ot">&lt;-</span> population_df <span class="sc">%&gt;%</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">district =</span> <span class="fu">case_when</span>(</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"JOHOR"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"KULAI"</span> <span class="sc">~</span> <span class="st">"KULAIJAYA"</span>,</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"JOHOR"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"TANGKAK"</span> <span class="sc">~</span> <span class="st">"LEDANG"</span>,</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"KELANTAN"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"KECIL LOJING"</span> <span class="sc">~</span> <span class="st">"GUA MUSANG"</span>,</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PAHANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"CAMERON HIGHLAND"</span> <span class="sc">~</span> <span class="st">"CAMERON HIGHLANDS"</span>,</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"HULU PERAK"</span> <span class="sc">~</span> <span class="st">"ULU PERAK"</span>,</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"BAGAN DATUK"</span> <span class="sc">~</span> <span class="st">"HILIR PERAK"</span>,</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"MANJUNG"</span> <span class="sc">~</span> <span class="st">"MANJUNG (DINDING)"</span>,</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"MUALLIM"</span> <span class="sc">~</span> <span class="st">"BATANG PADANG"</span>,</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SELAMA"</span> <span class="sc">~</span> <span class="st">"LARUT DAN MATANG"</span>,</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PULAU PINANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SEBERANG PERAI SELATAN"</span> <span class="sc">~</span> <span class="st">"S.P.SELATAN"</span>,</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PULAU PINANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SEBERANG PERAI TENGAH"</span> <span class="sc">~</span> <span class="st">"S.P. TENGAH"</span>,</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PULAU PINANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SEBERANG PERAI UTARA"</span> <span class="sc">~</span> <span class="st">"S.P. UTARA"</span>,</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PULAU PINANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SP SELATAN"</span> <span class="sc">~</span> <span class="st">"S.P.SELATAN"</span>,</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PULAU PINANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SP TENGAH"</span> <span class="sc">~</span> <span class="st">"S.P. TENGAH"</span>,</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PULAU PINANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SP UTARA"</span> <span class="sc">~</span> <span class="st">"S.P. UTARA"</span>,</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"TERENGGANU"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"KUALA NERUS"</span> <span class="sc">~</span> <span class="st">"KUALA TERENGGANU"</span>,</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"KUALA LUMPUR"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"W.P. KUALA LUMPUR"</span> <span class="sc">~</span> <span class="st">"WP. KUALA LUMPUR"</span>,</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> district</span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state, district, year) <span class="sc">%&gt;%</span></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">population =</span> <span class="fu">sum</span>(population))</span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>population_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 348 × 4
# Groups:   state, district [87]
   state district     year population
   &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;
 1 JOHOR BATU PAHAT   2019       495.
 2 JOHOR BATU PAHAT   2020       495.
 3 JOHOR BATU PAHAT   2021       497.
 4 JOHOR BATU PAHAT   2022       498.
 5 JOHOR JOHOR BAHRU  2019      1711.
 6 JOHOR JOHOR BAHRU  2020      1711.
 7 JOHOR JOHOR BAHRU  2021      1715.
 8 JOHOR JOHOR BAHRU  2022      1724.
 9 JOHOR KLUANG       2019       324.
10 JOHOR KLUANG       2020       324.
# ℹ 338 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mys_sf) <span class="sc">+</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"ADM2_EN"</span>, <span class="at">size =</span> <span class="fl">0.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="th_ex03_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="joining" class="level3">
<h3 class="anchored" data-anchor-id="joining">2.3.6 Joining</h3>
<section id="join-with-population-data" class="level4">
<h4 class="anchored" data-anchor-id="join-with-population-data">2.3.6.1 Join with Population Data</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>crime_df_mys <span class="ot">&lt;-</span> crime_df <span class="sc">%&gt;%</span> </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2019</span> <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(population_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"state"</span>, <span class="st">"district"</span>, <span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">crimes_pc =</span> crimes<span class="sc">/</span>population) <span class="sc">%&gt;%</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(state, district, year, category, type, crimes, crimes_pc, population)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-for-pokok-sena-district" class="level4">
<h4 class="anchored" data-anchor-id="create-for-pokok-sena-district">2.3.6.2 Create for Pokok Sena District</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>pokok_sena_rows <span class="ot">&lt;-</span> crime_df_mys <span class="sc">%&gt;%</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state <span class="sc">==</span> <span class="st">"KEDAH"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state, year, category, type) <span class="sc">%&gt;%</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">crimes =</span> <span class="fu">mean</span>(crimes),</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">crimes_pc =</span> <span class="fu">mean</span>(crimes_pc),</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">population =</span> <span class="fu">mean</span>(population)) <span class="sc">%&gt;%</span> </span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">district =</span> <span class="st">"POKOK SENA"</span>)</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>pokok_sena_rows</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 48 × 8
# Groups:   state, year, category [8]
   state  year category type                crimes crimes_pc population district
   &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;   
 1 KEDAH  2019 assault  causing_injury      29.8    0.140          189. POKOK S…
 2 KEDAH  2019 assault  murder               1.82   0.0129         189. POKOK S…
 3 KEDAH  2019 assault  rape                13.2    0.0752         189. POKOK S…
 4 KEDAH  2019 assault  robbery_gang_armed   0.182  0.00155        189. POKOK S…
 5 KEDAH  2019 assault  robbery_gang_unar…  25.3    0.0992         189. POKOK S…
 6 KEDAH  2019 assault  robbery_solo_armed   0.182  0.000410       189. POKOK S…
 7 KEDAH  2019 assault  robbery_solo_unar…  14.7    0.0590         189. POKOK S…
 8 KEDAH  2019 property break_in           103.     0.440          189. POKOK S…
 9 KEDAH  2019 property theft_other         86.9    0.479          189. POKOK S…
10 KEDAH  2019 property theft_vehicle_lor…   7.09   0.0202         189. POKOK S…
# ℹ 38 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>crime_df_mys <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(crime_df_mys, pokok_sena_rows)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="join-with-district-boundary" class="level4">
<h4 class="anchored" data-anchor-id="join-with-district-boundary">2.3.6.3 Join with District Boundary</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>crime_df_mys <span class="ot">&lt;-</span> crime_df_mys <span class="sc">%&gt;%</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mys_sf, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"state"</span> <span class="ot">=</span> <span class="st">"ADM1_EN"</span>, <span class="st">"district"</span> <span class="ot">=</span> <span class="st">"ADM2_EN"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(state, district, year, category, type, crimes, crimes_pc, population, geometry)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>crime_df_mys <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(crime_df_mys)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>crime_df_mys</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 4176 features and 8 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 184853.1 ymin: 139843.3 xmax: 728635.8 ymax: 744607.2
Projected CRS: Kertau (RSO) / RSO Malaya (m)
# A tibble: 4,176 × 9
# Groups:   state, district, year, category [696]
   state district    year category type              crimes crimes_pc population
   &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
 1 JOHOR BATU PAHAT  2019 assault  causing_injury        41   0.0828        495.
 2 JOHOR BATU PAHAT  2019 assault  murder                 3   0.00606       495.
 3 JOHOR BATU PAHAT  2019 assault  rape                  29   0.0586        495.
 4 JOHOR BATU PAHAT  2019 assault  robbery_gang_arm…      0   0             495.
 5 JOHOR BATU PAHAT  2019 assault  robbery_gang_una…     37   0.0747        495.
 6 JOHOR BATU PAHAT  2019 assault  robbery_solo_arm…      0   0             495.
 7 JOHOR BATU PAHAT  2019 assault  robbery_solo_una…     29   0.0586        495.
 8 JOHOR BATU PAHAT  2019 property break_in             157   0.317         495.
 9 JOHOR BATU PAHAT  2019 property theft_other          127   0.256         495.
10 JOHOR BATU PAHAT  2019 property theft_vehicle_lo…      4   0.00808       495.
# ℹ 4,166 more rows
# ℹ 1 more variable: geometry &lt;MULTIPOLYGON [m]&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="visualizing-the-distribution-of-crime" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-the-distribution-of-crime">2.3.7 Visualizing the distribution of crime</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>crime_df_mys_grp <span class="ot">&lt;-</span> crime_df_mys <span class="sc">%&gt;%</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state, district) <span class="sc">%&gt;%</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_crimes_pc =</span> <span class="fu">sum</span>(crimes_pc)<span class="sc">/</span><span class="dv">4</span>)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>choro <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(crime_df_mys_grp) <span class="sc">+</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"total_crimes_pc"</span>, </span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>, </span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"Crimes"</span>) <span class="sc">+</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Distribution of crime in West Malaysia"</span>,</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="fl">1.2</span>,</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.height =</span> <span class="fl">0.45</span>, </span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.width =</span> <span class="fl">0.35</span>,</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">frame =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type=</span><span class="st">"8star"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>() <span class="sc">+</span></span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_grid</span>(<span class="at">alpha =</span><span class="fl">0.2</span>)</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>choro</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="th_ex03_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="correlation-plot" class="level3">
<h3 class="anchored" data-anchor-id="correlation-plot">2.3.8 Correlation Plot</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>piv_crime_df_mys <span class="ot">&lt;-</span> crime_df_mys <span class="sc">%&gt;%</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cat_type =</span> <span class="fu">paste</span>(category, type, <span class="at">sep =</span> <span class="st">"-"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category, <span class="sc">-</span>type, <span class="sc">-</span>crimes, <span class="sc">-</span>population) <span class="sc">%&gt;%</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> cat_type,</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> crimes_pc,</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_fill =</span> <span class="dv">0</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot.mixed</span>(<span class="fu">cor</span>(<span class="fu">st_drop_geometry</span>(piv_crime_df_mys)[, <span class="dv">4</span><span class="sc">:</span><span class="dv">15</span>]),</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">lower =</span> <span class="st">"ellipse"</span>, </span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">upper =</span> <span class="st">"number"</span>,</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">tl.pos =</span> <span class="st">"lt"</span>,</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">diag =</span> <span class="st">"l"</span>,</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">tl.col =</span> <span class="st">"black"</span>,</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">tl.srt =</span> <span class="dv">45</span>, </span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">tl.cex =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="th_ex03_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>To further narrow our correlation analysis we will group robbery as one category and vehicle theft as the other</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>piv_crime_df_mys <span class="ot">&lt;-</span> piv_crime_df_mys <span class="sc">%&gt;%</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">robbery =</span> <span class="st">`</span><span class="at">assault-robbery_gang_armed</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">assault-robbery_gang_unarmed</span><span class="st">`</span> <span class="sc">+</span> </span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">assault-robbery_solo_armed</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">assault-robbery_solo_unarmed</span><span class="st">`</span>,</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">vehicle_theft =</span> <span class="st">`</span><span class="at">property-theft_vehicle_lorry</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">property-theft_vehicle_motorcar</span><span class="st">`</span> <span class="sc">+</span> </span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">property-theft_vehicle_motorcycle</span><span class="st">`</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">assault-robbery_gang_armed</span><span class="st">`</span>, <span class="sc">-</span><span class="st">`</span><span class="at">assault-robbery_gang_unarmed</span><span class="st">`</span>, </span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span><span class="st">`</span><span class="at">assault-robbery_solo_armed</span><span class="st">`</span>, <span class="sc">-</span><span class="st">`</span><span class="at">assault-robbery_solo_unarmed</span><span class="st">`</span>,</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span><span class="st">`</span><span class="at">property-theft_vehicle_lorry</span><span class="st">`</span>, <span class="sc">-</span><span class="st">`</span><span class="at">property-theft_vehicle_motorcar</span><span class="st">`</span>, </span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span><span class="st">`</span><span class="at">property-theft_vehicle_motorcycle</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span><span class="fu">str_remove</span>(., <span class="st">"^assault-|^property-"</span>))</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>piv_crime_df_mys</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 348 features and 10 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 184853.1 ymin: 139843.3 xmax: 728635.8 ymax: 744607.2
Projected CRS: Kertau (RSO) / RSO Malaya (m)
# A tibble: 348 × 11
   state district   year                  geometry causing_injury  murder   rape
   &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt;        &lt;MULTIPOLYGON [m]&gt;          &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
 1 JOHOR BATU PAH…  2019 (((556714.6 192051.6, 55…         0.0828 0.00606 0.0586
 2 JOHOR BATU PAH…  2020 (((556714.6 192051.6, 55…         0.0868 0.00606 0.0323
 3 JOHOR BATU PAH…  2021 (((556714.6 192051.6, 55…         0.0442 0       0.0362
 4 JOHOR BATU PAH…  2022 (((556714.6 192051.6, 55…         0.0382 0.00603 0.0261
 5 JOHOR JOHOR BA…  2019 (((664760.7 157664.3, 66…         0.212  0.0117  0.0590
 6 JOHOR JOHOR BA…  2020 (((664760.7 157664.3, 66…         0.140  0.00993 0.0392
 7 JOHOR JOHOR BA…  2021 (((664760.7 157664.3, 66…         0.113  0.00466 0.0402
 8 JOHOR JOHOR BA…  2022 (((664760.7 157664.3, 66…         0.101  0.00986 0.0365
 9 JOHOR KLUANG     2019 (((583499.3 195230.8, 58…         0.185  0.0124  0.0525
10 JOHOR KLUANG     2020 (((583499.3 195230.8, 58…         0.133  0.00618 0.0494
# ℹ 338 more rows
# ℹ 4 more variables: break_in &lt;dbl&gt;, theft_other &lt;dbl&gt;, robbery &lt;dbl&gt;,
#   vehicle_theft &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot.mixed</span>(<span class="fu">cor</span>(<span class="fu">st_drop_geometry</span>(piv_crime_df_mys)[, <span class="dv">4</span><span class="sc">:</span><span class="dv">10</span>]),</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">lower =</span> <span class="st">"ellipse"</span>, </span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">upper =</span> <span class="st">"number"</span>,</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">tl.pos =</span> <span class="st">"lt"</span>,</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">diag =</span> <span class="st">"l"</span>,</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">tl.col =</span> <span class="st">"black"</span>,</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">tl.srt =</span> <span class="dv">45</span>, </span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">tl.cex =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="th_ex03_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="data-enrichment" class="level2">
<h2 class="anchored" data-anchor-id="data-enrichment">2.4 Data Enrichment</h2>
<p>We realize we ran into some issue with the dataset, as they were too highly correlated, hence we decided enrich our data with several more relevant datasets which may affect crime rates such enrollment in schools, labour participation, and poverty by district</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>poverty_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/poverty_district.csv"</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>inequality_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/inequality_district.csv"</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>labour_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/labour_district.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="clearning-state" class="level3">
<h3 class="anchored" data-anchor-id="clearning-state">2.4.1 Clearning (State)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Unique states in mys_sf:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Unique states in mys_sf:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(mys_sf<span class="sc">$</span>ADM1_EN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "JOHOR"           "KEDAH"           "KELANTAN"        "KUALA LUMPUR"   
 [5] "MELAKA"          "NEGERI SEMBILAN" "PAHANG"          "PERAK"          
 [9] "PERLIS"          "PULAU PINANG"    "TERENGGANU"      "SELANGOR"       </code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Unique states in poverty_df:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Unique states in poverty_df:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(poverty_df<span class="sc">$</span>state)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Johor"             "Kedah"             "Kelantan"         
 [4] "Melaka"            "Negeri Sembilan"   "Pahang"           
 [7] "Perak"             "Perlis"            "Pulau Pinang"     
[10] "Sabah"             "Sarawak"           "Selangor"         
[13] "Terengganu"        "W.P. Kuala Lumpur" "W.P. Labuan"      
[16] "W.P. Putrajaya"   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Unique states in inequality_df:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Unique states in inequality_df:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(inequality_df<span class="sc">$</span>state)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Johor"             "Kedah"             "Kelantan"         
 [4] "Melaka"            "Negeri Sembilan"   "Pahang"           
 [7] "Perak"             "Perlis"            "Pulau Pinang"     
[10] "Sabah"             "Sarawak"           "Selangor"         
[13] "Terengganu"        "W.P. Kuala Lumpur" "W.P. Labuan"      
[16] "W.P. Putrajaya"   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Unique states in labour_df:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Unique states in labour_df:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(labour_df<span class="sc">$</span>state)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Johor"           "Kedah"           "Kelantan"        "Melaka"         
 [5] "Negeri Sembilan" "Pahang"          "Perak"           "Pulau Pinang"   
 [9] "Sabah"           "Sarawak"         "Selangor"        "Terengganu"     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>poverty_df <span class="ot">&lt;-</span> poverty_df <span class="sc">%&gt;%</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(date),</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">state =</span> <span class="fu">toupper</span>(state),</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">district =</span> <span class="fu">toupper</span>(district)) <span class="sc">%&gt;%</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">filter</span>(state <span class="sc">!=</span> <span class="st">'SABAH'</span> <span class="sc">&amp;</span> state <span class="sc">!=</span> <span class="st">'SARAWAK'</span> <span class="sc">&amp;</span> state <span class="sc">!=</span> <span class="st">'W.P. LABUAN'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">replace</span>(state, state <span class="sc">==</span> <span class="st">'W.P. KUALA LUMPUR'</span>, <span class="st">'KUALA LUMPUR'</span>),</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">state =</span> <span class="fu">replace</span>(state, state <span class="sc">==</span> <span class="st">'W.P. PUTRAJAYA'</span>, <span class="st">'KUALA LUMPUR'</span>))</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>inequality_df <span class="ot">&lt;-</span> inequality_df <span class="sc">%&gt;%</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(date),</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">state =</span> <span class="fu">toupper</span>(state),</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">district =</span> <span class="fu">toupper</span>(district)) <span class="sc">%&gt;%</span></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>          <span class="fu">filter</span>(state <span class="sc">!=</span> <span class="st">'SABAH'</span> <span class="sc">&amp;</span> state <span class="sc">!=</span> <span class="st">'SARAWAK'</span> <span class="sc">&amp;</span> state <span class="sc">!=</span> <span class="st">'W.P. LABUAN'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">replace</span>(state, state <span class="sc">==</span> <span class="st">'W.P. KUALA LUMPUR'</span>, <span class="st">'KUALA LUMPUR'</span>),</span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">state =</span> <span class="fu">replace</span>(state, state <span class="sc">==</span> <span class="st">'W.P. PUTRAJAYA'</span>, <span class="st">'KUALA LUMPUR'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>labour_df <span class="ot">&lt;-</span> labour_df <span class="sc">%&gt;%</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(date),</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">state =</span> <span class="fu">toupper</span>(state),</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">district =</span> <span class="fu">toupper</span>(district)) <span class="sc">%&gt;%</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">filter</span>(state <span class="sc">!=</span> <span class="st">'SABAH'</span> <span class="sc">&amp;</span> state <span class="sc">!=</span> <span class="st">'SARAWAK'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Unique states &amp; years in mys_sf:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Unique states &amp; years in mys_sf:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">unique</span>(mys_sf<span class="sc">$</span>ADM1_EN))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "JOHOR"           "KEDAH"           "KELANTAN"        "KUALA LUMPUR"   
 [5] "MELAKA"          "NEGERI SEMBILAN" "PAHANG"          "PERAK"          
 [9] "PERLIS"          "PULAU PINANG"    "SELANGOR"        "TERENGGANU"     </code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Unique states &amp; years in poverty_df:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Unique states &amp; years in poverty_df:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">unique</span>(poverty_df<span class="sc">$</span>state))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "JOHOR"           "KEDAH"           "KELANTAN"        "KUALA LUMPUR"   
 [5] "MELAKA"          "NEGERI SEMBILAN" "PAHANG"          "PERAK"          
 [9] "PERLIS"          "PULAU PINANG"    "SELANGOR"        "TERENGGANU"     </code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">unique</span>(poverty_df<span class="sc">$</span>year))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2019 2022</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Unique states &amp; years in inequality_df:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Unique states &amp; years in inequality_df:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">unique</span>(inequality_df<span class="sc">$</span>state))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "JOHOR"           "KEDAH"           "KELANTAN"        "KUALA LUMPUR"   
 [5] "MELAKA"          "NEGERI SEMBILAN" "PAHANG"          "PERAK"          
 [9] "PERLIS"          "PULAU PINANG"    "SELANGOR"        "TERENGGANU"     </code></pre>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">unique</span>(inequality_df<span class="sc">$</span>year))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2019 2022</code></pre>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Unique states &amp; years in labour_df:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Unique states &amp; years in labour_df:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">unique</span>(labour_df<span class="sc">$</span>state))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "JOHOR"           "KEDAH"           "KELANTAN"        "MELAKA"         
 [5] "NEGERI SEMBILAN" "PAHANG"          "PERAK"           "PULAU PINANG"   
 [9] "SELANGOR"        "TERENGGANU"     </code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">unique</span>(labour_df<span class="sc">$</span>year))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2019 2020 2021 2022</code></pre>
</div>
</div>
<p>From the data we identified 2 issues: 1. Poverty and Inequality data is missing years 2020 and 2021 2. Labour data is missing PERLIS, KUALA LUMPUR and PUTRAJAYA</p>
</section>
<section id="poverty-inequaltiy-state-district" class="level3">
<h3 class="anchored" data-anchor-id="poverty-inequaltiy-state-district">2.4.2 Poverty &amp; Inequaltiy (State-District)</h3>
<section id="duplicating-data" class="level4">
<h4 class="anchored" data-anchor-id="duplicating-data">2.4.2.1 Duplicating Data</h4>
<p>Since years 2020 and 2021 are missing from data set, we will do a best effort mapping for year: - 2020 -&gt; 2019 - 2021 -&gt; 2022</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>poverty_rows <span class="ot">&lt;-</span> poverty_df <span class="sc">%&gt;%</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">ifelse</span>(year <span class="sc">==</span> <span class="dv">2019</span>, <span class="dv">2020</span>, <span class="dv">2021</span>))</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>poverty_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(poverty_df, poverty_rows)</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(poverty_df<span class="sc">$</span>year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2019 2022 2020 2021</code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>inequality_rows <span class="ot">&lt;-</span> inequality_df <span class="sc">%&gt;%</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">ifelse</span>(year <span class="sc">==</span> <span class="dv">2019</span>, <span class="dv">2020</span>, <span class="dv">2021</span>))</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>inequality_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(inequality_df, inequality_rows)</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(inequality_df<span class="sc">$</span>year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2019 2022 2020 2021</code></pre>
</div>
</div>
</section>
<section id="check-for-mismatch-2" class="level4">
<h4 class="anchored" data-anchor-id="check-for-mismatch-2">2.4.2.2 Check for Mismatch</h4>
<p>Creating rows for state-district</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>poverty_df <span class="ot">&lt;-</span> poverty_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">state_district =</span> <span class="fu">paste</span>(state, district, <span class="at">sep =</span> <span class="st">"-"</span>))</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>inequality_df <span class="ot">&lt;-</span> inequality_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">state_district =</span> <span class="fu">paste</span>(state, district, <span class="at">sep =</span> <span class="st">"-"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming you have two character vectors:</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>state_district_poverty <span class="ot">&lt;-</span> <span class="fu">unique</span>(poverty_df<span class="sc">$</span>state_district)</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Find mismatches</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>missing_in_sf <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(state_district_poverty, state_district_sf)</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>missing_in_poverty <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(state_district_sf, state_district_poverty)</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the mismatches</span></span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"State-District combinations in poverty_df not found in mys_sf:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "State-District combinations in poverty_df not found in mys_sf:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(missing_in_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "JOHOR-KULAI"                         "JOHOR-TANGKAK"                      
 [3] "KELANTAN-KECIL LOJING"               "PERAK-BAGAN DATUK"                  
 [5] "PERAK-HULU PERAK"                    "PERAK-MANJUNG"                      
 [7] "PERAK-MUALLIM"                       "PERAK-SELAMA"                       
 [9] "PULAU PINANG-SEBERANG PERAI SELATAN" "PULAU PINANG-SEBERANG PERAI TENGAH" 
[11] "PULAU PINANG-SEBERANG PERAI UTARA"   "TERENGGANU-KUALA NERUS"             
[13] "KUALA LUMPUR-W.P. KUALA LUMPUR"     </code></pre>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"State-District combinations in mys_sf not found in poverty_df:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "State-District combinations in mys_sf not found in poverty_df:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(missing_in_poverty)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "JOHOR-KULAIJAYA"               "JOHOR-LEDANG"                 
[3] "KUALA LUMPUR-WP. KUALA LUMPUR" "PERAK-ULU PERAK"              
[5] "PERAK-MANJUNG (DINDING)"       "PULAU PINANG-S.P.SELATAN"     
[7] "PULAU PINANG-S.P. TENGAH"      "PULAU PINANG-S.P. UTARA"      </code></pre>
</div>
</div>
</section>
<section id="cleaning-2" class="level4">
<h4 class="anchored" data-anchor-id="cleaning-2">2.4.2.3 Cleaning</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>poverty_df <span class="ot">&lt;-</span> poverty_df <span class="sc">%&gt;%</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">district =</span> <span class="fu">case_when</span>(</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"JOHOR"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"KULAI"</span> <span class="sc">~</span> <span class="st">"KULAIJAYA"</span>,</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"JOHOR"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"TANGKAK"</span> <span class="sc">~</span> <span class="st">"LEDANG"</span>,</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"KELANTAN"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"KECIL LOJING"</span> <span class="sc">~</span> <span class="st">"GUA MUSANG"</span>,</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"HULU PERAK"</span> <span class="sc">~</span> <span class="st">"ULU PERAK"</span>,</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"BAGAN DATUK"</span> <span class="sc">~</span> <span class="st">"HILIR PERAK"</span>,</span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"MANJUNG"</span> <span class="sc">~</span> <span class="st">"MANJUNG (DINDING)"</span>,</span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"MUALLIM"</span> <span class="sc">~</span> <span class="st">"BATANG PADANG"</span>,</span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SELAMA"</span> <span class="sc">~</span> <span class="st">"LARUT DAN MATANG"</span>,</span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PULAU PINANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SEBERANG PERAI SELATAN"</span> <span class="sc">~</span> <span class="st">"S.P.SELATAN"</span>,</span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PULAU PINANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SEBERANG PERAI TENGAH"</span> <span class="sc">~</span> <span class="st">"S.P. TENGAH"</span>,</span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PULAU PINANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SEBERANG PERAI UTARA"</span> <span class="sc">~</span> <span class="st">"S.P. UTARA"</span>,</span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"TERENGGANU"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"KUALA NERUS"</span> <span class="sc">~</span> <span class="st">"KUALA TERENGGANU"</span>,</span>
<span id="cb129-15"><a href="#cb129-15" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"KUALA LUMPUR"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"W.P. KUALA LUMPUR"</span> <span class="sc">~</span> <span class="st">"WP. KUALA LUMPUR"</span>,</span>
<span id="cb129-16"><a href="#cb129-16" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> district</span>
<span id="cb129-17"><a href="#cb129-17" aria-hidden="true" tabindex="-1"></a>  )) </span>
<span id="cb129-18"><a href="#cb129-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-19"><a href="#cb129-19" aria-hidden="true" tabindex="-1"></a>poverty_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 366 × 7
   state district    date       poverty_absolute poverty_relative  year
   &lt;chr&gt; &lt;chr&gt;       &lt;date&gt;                &lt;dbl&gt;            &lt;dbl&gt; &lt;dbl&gt;
 1 JOHOR BATU PAHAT  2019-01-01              2.9              9    2019
 2 JOHOR BATU PAHAT  2022-01-01              5.1             19.4  2022
 3 JOHOR JOHOR BAHRU 2019-01-01              3.3             12.8  2019
 4 JOHOR JOHOR BAHRU 2022-01-01              3.7             10.4  2022
 5 JOHOR KLUANG      2019-01-01              5               24.9  2019
 6 JOHOR KLUANG      2022-01-01              7.2             27.4  2022
 7 JOHOR KOTA TINGGI 2019-01-01              6               20.8  2019
 8 JOHOR KOTA TINGGI 2022-01-01              5               17    2022
 9 JOHOR KULAIJAYA   2019-01-01              3.2             10.1  2019
10 JOHOR KULAIJAYA   2022-01-01              0.4              7.4  2022
# ℹ 356 more rows
# ℹ 1 more variable: state_district &lt;chr&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>inequality_df <span class="ot">&lt;-</span> inequality_df <span class="sc">%&gt;%</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">district =</span> <span class="fu">case_when</span>(</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"JOHOR"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"KULAI"</span> <span class="sc">~</span> <span class="st">"KULAIJAYA"</span>,</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"JOHOR"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"TANGKAK"</span> <span class="sc">~</span> <span class="st">"LEDANG"</span>,</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"KELANTAN"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"KECIL LOJING"</span> <span class="sc">~</span> <span class="st">"GUA MUSANG"</span>,</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"HULU PERAK"</span> <span class="sc">~</span> <span class="st">"ULU PERAK"</span>,</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"BAGAN DATUK"</span> <span class="sc">~</span> <span class="st">"HILIR PERAK"</span>,</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"MANJUNG"</span> <span class="sc">~</span> <span class="st">"MANJUNG (DINDING)"</span>,</span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"MUALLIM"</span> <span class="sc">~</span> <span class="st">"BATANG PADANG"</span>,</span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SELAMA"</span> <span class="sc">~</span> <span class="st">"LARUT DAN MATANG"</span>,</span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PULAU PINANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SEBERANG PERAI SELATAN"</span> <span class="sc">~</span> <span class="st">"S.P.SELATAN"</span>,</span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PULAU PINANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SEBERANG PERAI TENGAH"</span> <span class="sc">~</span> <span class="st">"S.P. TENGAH"</span>,</span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PULAU PINANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SEBERANG PERAI UTARA"</span> <span class="sc">~</span> <span class="st">"S.P. UTARA"</span>,</span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"TERENGGANU"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"KUALA NERUS"</span> <span class="sc">~</span> <span class="st">"KUALA TERENGGANU"</span>,</span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"KUALA LUMPUR"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"W.P. KUALA LUMPUR"</span> <span class="sc">~</span> <span class="st">"WP. KUALA LUMPUR"</span>,</span>
<span id="cb131-16"><a href="#cb131-16" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> district</span>
<span id="cb131-17"><a href="#cb131-17" aria-hidden="true" tabindex="-1"></a>  )) </span>
<span id="cb131-18"><a href="#cb131-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-19"><a href="#cb131-19" aria-hidden="true" tabindex="-1"></a>inequality_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 366 × 6
   state district    date        gini  year state_district   
   &lt;chr&gt; &lt;chr&gt;       &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;            
 1 JOHOR BATU PAHAT  2019-01-01 0.295  2019 JOHOR-BATU PAHAT 
 2 JOHOR BATU PAHAT  2022-01-01 0.338  2022 JOHOR-BATU PAHAT 
 3 JOHOR JOHOR BAHRU 2019-01-01 0.388  2019 JOHOR-JOHOR BAHRU
 4 JOHOR JOHOR BAHRU 2022-01-01 0.359  2022 JOHOR-JOHOR BAHRU
 5 JOHOR KLUANG      2019-01-01 0.333  2019 JOHOR-KLUANG     
 6 JOHOR KLUANG      2022-01-01 0.354  2022 JOHOR-KLUANG     
 7 JOHOR KOTA TINGGI 2019-01-01 0.361  2019 JOHOR-KOTA TINGGI
 8 JOHOR KOTA TINGGI 2022-01-01 0.343  2022 JOHOR-KOTA TINGGI
 9 JOHOR KULAIJAYA   2019-01-01 0.324  2019 JOHOR-KULAI      
10 JOHOR KULAIJAYA   2022-01-01 0.337  2022 JOHOR-KULAI      
# ℹ 356 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming you have two character vectors:</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>poverty_df <span class="ot">&lt;-</span> poverty_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">state_district =</span> <span class="fu">paste</span>(state, district, <span class="at">sep =</span> <span class="st">"-"</span>))</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>state_district_poverty <span class="ot">&lt;-</span> <span class="fu">unique</span>(poverty_df<span class="sc">$</span>state_district)</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Find mismatches</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>missing_in_sf <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(state_district_poverty, state_district_sf)</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>missing_in_poverty <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(state_district_sf, state_district_poverty)</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the mismatches</span></span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"State-District combinations in poverty_df not found in mys_sf:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "State-District combinations in poverty_df not found in mys_sf:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(missing_in_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>character(0)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"State-District combinations in mys_sf not found in poverty_df:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "State-District combinations in mys_sf not found in poverty_df:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(missing_in_poverty)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>character(0)</code></pre>
</div>
</div>
</section>
</section>
<section id="wrangling-labour" class="level3">
<h3 class="anchored" data-anchor-id="wrangling-labour">2.4.3 Wrangling Labour</h3>
<section id="check-for-mismatch-3" class="level4">
<h4 class="anchored" data-anchor-id="check-for-mismatch-3">2.4.3.1 Check for Mismatch</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>labour_df <span class="ot">&lt;-</span> labour_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">state_district =</span> <span class="fu">paste</span>(state, district, <span class="at">sep =</span> <span class="st">"-"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming you have two character vectors:</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>state_district_labour <span class="ot">&lt;-</span> <span class="fu">unique</span>(labour_df<span class="sc">$</span>state_district)</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Find mismatches</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>missing_in_sf <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(state_district_labour, state_district_sf)</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>missing_in_labour <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(state_district_sf, state_district_labour)</span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the mismatches</span></span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"State-District combinations in labour_df not found in mys_sf:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "State-District combinations in labour_df not found in mys_sf:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(missing_in_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "JOHOR-KULAI"                         "JOHOR-TANGKAK"                      
[3] "PERAK-HULU PERAK"                    "PERAK-MANJUNG"                      
[5] "PULAU PINANG-SEBERANG PERAI SELATAN" "PULAU PINANG-SEBERANG PERAI TENGAH" 
[7] "PULAU PINANG-SEBERANG PERAI UTARA"  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"State-District combinations in mys_sf not found in labour_df:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "State-District combinations in mys_sf not found in labour_df:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(missing_in_labour)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "JOHOR-KULAIJAYA"               "JOHOR-LEDANG"                 
 [3] "KUALA LUMPUR-WP. KUALA LUMPUR" "PERAK-ULU PERAK"              
 [5] "PERAK-MANJUNG (DINDING)"       "PERLIS-PERLIS"                
 [7] "PULAU PINANG-S.P.SELATAN"      "PULAU PINANG-S.P. TENGAH"     
 [9] "PULAU PINANG-S.P. UTARA"       "KUALA LUMPUR-W.P. PUTRAJAYA"  </code></pre>
</div>
</div>
</section>
<section id="cleaning-3" class="level4">
<h4 class="anchored" data-anchor-id="cleaning-3">2.4.3.1 Cleaning</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>labour_df <span class="ot">&lt;-</span> labour_df <span class="sc">%&gt;%</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">district =</span> <span class="fu">case_when</span>(</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"JOHOR"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"KULAI"</span> <span class="sc">~</span> <span class="st">"KULAIJAYA"</span>,</span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"JOHOR"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"TANGKAK"</span> <span class="sc">~</span> <span class="st">"LEDANG"</span>,</span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"HULU PERAK"</span> <span class="sc">~</span> <span class="st">"ULU PERAK"</span>,</span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PERAK"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"MANJUNG"</span> <span class="sc">~</span> <span class="st">"MANJUNG (DINDING)"</span>,</span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PULAU PINANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SEBERANG PERAI SELATAN"</span> <span class="sc">~</span> <span class="st">"S.P.SELATAN"</span>,</span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PULAU PINANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SEBERANG PERAI TENGAH"</span> <span class="sc">~</span> <span class="st">"S.P. TENGAH"</span>,</span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a>    state <span class="sc">==</span> <span class="st">"PULAU PINANG"</span> <span class="sc">&amp;</span> district <span class="sc">==</span> <span class="st">"SEBERANG PERAI UTARA"</span> <span class="sc">~</span> <span class="st">"S.P. UTARA"</span>,</span>
<span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> district</span>
<span id="cb150-11"><a href="#cb150-11" aria-hidden="true" tabindex="-1"></a>  )) </span>
<span id="cb150-12"><a href="#cb150-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-13"><a href="#cb150-13" aria-hidden="true" tabindex="-1"></a>labour_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336 × 12
   state district   date          lf lf_employed lf_unemployed lf_outside p_rate
   &lt;chr&gt; &lt;chr&gt;      &lt;date&gt;     &lt;dbl&gt;       &lt;dbl&gt;         &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;
 1 JOHOR BATU PAHAT 2019-01-01  214.        210.           3.7       90.4   70.3
 2 JOHOR BATU PAHAT 2020-01-01  219.        214.           4.7       92.2   70.4
 3 JOHOR BATU PAHAT 2021-01-01  216         211            5         97.1   69  
 4 JOHOR BATU PAHAT 2022-01-01  221.        217.           4         94.6   70  
 5 JOHOR JOHOR BAH… 2019-01-01  792.        768.          24.6      294.    73  
 6 JOHOR JOHOR BAH… 2020-01-01  804.        771.          32.5      297.    73  
 7 JOHOR JOHOR BAH… 2021-01-01  806.        772.          34.1      298.    73  
 8 JOHOR JOHOR BAH… 2022-01-01  830.        799           30.5      293.    73.9
 9 JOHOR KLUANG     2019-01-01  166.        160.           5.6       66.9   71.3
10 JOHOR KLUANG     2020-01-01  168.        161.           7.1       67.4   71.4
# ℹ 326 more rows
# ℹ 4 more variables: u_rate &lt;dbl&gt;, ep_ratio &lt;dbl&gt;, year &lt;dbl&gt;,
#   state_district &lt;chr&gt;</code></pre>
</div>
</div>
<p>However we do not have labor data, hence we will use the national average “PERLIS-PERLIS” “KUALA LUMPUR-WP. KUALA LUMPUR” “KUALA LUMPUR-W.P. PUTRAJAYA”</p>
</section>
</section>
<section id="joining-1" class="level3">
<h3 class="anchored" data-anchor-id="joining-1">2.4.4 Joining</h3>
<section id="selecting-relevant-years" class="level4">
<h4 class="anchored" data-anchor-id="selecting-relevant-years">2.4.4.1 Selecting Relevant Years</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>piv_full_df_mys <span class="ot">&lt;-</span> piv_crime_df_mys <span class="sc">%&gt;%</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(poverty_df, <span class="sc">-</span>date, <span class="sc">-</span>state_district), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"state"</span>, <span class="st">"district"</span>, <span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(inequality_df, <span class="sc">-</span>date, <span class="sc">-</span>state_district), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"state"</span>, <span class="st">"district"</span>, <span class="st">"year"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(labour_df, <span class="sc">-</span>date, <span class="sc">-</span>state_district), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"state"</span>, <span class="st">"district"</span>, <span class="st">"year"</span>))</span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>piv_full_df_mys</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 402 features and 20 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 184853.1 ymin: 139843.3 xmax: 728635.8 ymax: 744607.2
Projected CRS: Kertau (RSO) / RSO Malaya (m)
# A tibble: 402 × 21
   state district   year                  geometry causing_injury  murder   rape
   &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt;        &lt;MULTIPOLYGON [m]&gt;          &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
 1 JOHOR BATU PAH…  2019 (((556714.6 192051.6, 55…         0.0828 0.00606 0.0586
 2 JOHOR BATU PAH…  2020 (((556714.6 192051.6, 55…         0.0868 0.00606 0.0323
 3 JOHOR BATU PAH…  2021 (((556714.6 192051.6, 55…         0.0442 0       0.0362
 4 JOHOR BATU PAH…  2022 (((556714.6 192051.6, 55…         0.0382 0.00603 0.0261
 5 JOHOR JOHOR BA…  2019 (((664760.7 157664.3, 66…         0.212  0.0117  0.0590
 6 JOHOR JOHOR BA…  2020 (((664760.7 157664.3, 66…         0.140  0.00993 0.0392
 7 JOHOR JOHOR BA…  2021 (((664760.7 157664.3, 66…         0.113  0.00466 0.0402
 8 JOHOR JOHOR BA…  2022 (((664760.7 157664.3, 66…         0.101  0.00986 0.0365
 9 JOHOR KLUANG     2019 (((583499.3 195230.8, 58…         0.185  0.0124  0.0525
10 JOHOR KLUANG     2020 (((583499.3 195230.8, 58…         0.133  0.00618 0.0494
# ℹ 392 more rows
# ℹ 14 more variables: break_in &lt;dbl&gt;, theft_other &lt;dbl&gt;, robbery &lt;dbl&gt;,
#   vehicle_theft &lt;dbl&gt;, poverty_absolute &lt;dbl&gt;, poverty_relative &lt;dbl&gt;,
#   gini &lt;dbl&gt;, lf &lt;dbl&gt;, lf_employed &lt;dbl&gt;, lf_unemployed &lt;dbl&gt;,
#   lf_outside &lt;dbl&gt;, p_rate &lt;dbl&gt;, u_rate &lt;dbl&gt;, ep_ratio &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="data-subsitution-labour" class="level4">
<h4 class="anchored" data-anchor-id="data-subsitution-labour">2.4.4.2 Data Subsitution (Labour)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify the specific state-district combinations</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>target_states <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PERLIS"</span>, <span class="st">"KUALA LUMPUR"</span>)</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>target_districts <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PERLIS"</span>, <span class="st">"WP. KUALA LUMPUR"</span>, <span class="st">"W.P. PUTRAJAYA"</span>)</span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the average values for the missing columns (assuming the columns exist)</span></span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a>avg_values <span class="ot">&lt;-</span> piv_full_df_mys <span class="sc">%&gt;%</span></span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(state <span class="sc">%in%</span> target_states <span class="sc">&amp;</span> district <span class="sc">%in%</span> target_districts)) <span class="sc">%&gt;%</span></span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_lf =</span> <span class="fu">mean</span>(lf, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb154-10"><a href="#cb154-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_lf_employed =</span> <span class="fu">mean</span>(lf_employed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb154-11"><a href="#cb154-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_lf_unemployed =</span> <span class="fu">mean</span>(lf_unemployed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb154-12"><a href="#cb154-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_lf_outside =</span> <span class="fu">mean</span>(lf_outside, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb154-13"><a href="#cb154-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_p_rate =</span> <span class="fu">mean</span>(p_rate, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb154-14"><a href="#cb154-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_u_rate =</span> <span class="fu">mean</span>(u_rate, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb154-15"><a href="#cb154-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_ep_ratio =</span> <span class="fu">mean</span>(ep_ratio, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-16"><a href="#cb154-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb154-17"><a href="#cb154-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-18"><a href="#cb154-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace missing values in the target rows</span></span>
<span id="cb154-19"><a href="#cb154-19" aria-hidden="true" tabindex="-1"></a>piv_full_df_mys <span class="ot">&lt;-</span> piv_full_df_mys <span class="sc">%&gt;%</span></span>
<span id="cb154-20"><a href="#cb154-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb154-21"><a href="#cb154-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">lf =</span> <span class="fu">ifelse</span>(state <span class="sc">%in%</span> target_states <span class="sc">&amp;</span> district <span class="sc">%in%</span> target_districts <span class="sc">&amp;</span> <span class="fu">is.na</span>(lf), avg_values<span class="sc">$</span>avg_lf, lf),</span>
<span id="cb154-22"><a href="#cb154-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">lf_employed =</span> <span class="fu">ifelse</span>(state <span class="sc">%in%</span> target_states <span class="sc">&amp;</span> district <span class="sc">%in%</span> target_districts <span class="sc">&amp;</span> <span class="fu">is.na</span>(lf_employed), avg_values<span class="sc">$</span>avg_lf_employed, lf_employed),</span>
<span id="cb154-23"><a href="#cb154-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">lf_unemployed =</span> <span class="fu">ifelse</span>(state <span class="sc">%in%</span> target_states <span class="sc">&amp;</span> district <span class="sc">%in%</span> target_districts <span class="sc">&amp;</span> <span class="fu">is.na</span>(lf_unemployed), avg_values<span class="sc">$</span>avg_lf_unemployed, lf_unemployed),</span>
<span id="cb154-24"><a href="#cb154-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">lf_outside =</span> <span class="fu">ifelse</span>(state <span class="sc">%in%</span> target_states <span class="sc">&amp;</span> district <span class="sc">%in%</span> target_districts <span class="sc">&amp;</span> <span class="fu">is.na</span>(lf_outside), avg_values<span class="sc">$</span>avg_lf_outside, lf_outside),</span>
<span id="cb154-25"><a href="#cb154-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_rate =</span> <span class="fu">ifelse</span>(state <span class="sc">%in%</span> target_states <span class="sc">&amp;</span> district <span class="sc">%in%</span> target_districts <span class="sc">&amp;</span> <span class="fu">is.na</span>(p_rate), avg_values<span class="sc">$</span>avg_p_rate, p_rate),</span>
<span id="cb154-26"><a href="#cb154-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">u_rate =</span> <span class="fu">ifelse</span>(state <span class="sc">%in%</span> target_states <span class="sc">&amp;</span> district <span class="sc">%in%</span> target_districts <span class="sc">&amp;</span> <span class="fu">is.na</span>(u_rate), avg_values<span class="sc">$</span>avg_u_rate, u_rate),</span>
<span id="cb154-27"><a href="#cb154-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">ep_ratio =</span> <span class="fu">ifelse</span>(state <span class="sc">%in%</span> target_states <span class="sc">&amp;</span> district <span class="sc">%in%</span> target_districts <span class="sc">&amp;</span> <span class="fu">is.na</span>(ep_ratio), avg_values<span class="sc">$</span>avg_ep_ratio, ep_ratio)</span>
<span id="cb154-28"><a href="#cb154-28" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="data-selection" class="level2">
<h2 class="anchored" data-anchor-id="data-selection">2.5 Data Selection</h2>
<section id="visualizing-the-correlation-of-data" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-the-correlation-of-data">2.5.1 Visualizing the Correlation of Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot.mixed</span>(<span class="fu">cor</span>(<span class="fu">st_drop_geometry</span>(piv_full_df_mys)[, <span class="dv">4</span><span class="sc">:</span><span class="dv">20</span>]),</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">lower =</span> <span class="st">"ellipse"</span>, </span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">upper =</span> <span class="st">"number"</span>,</span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">tl.pos =</span> <span class="st">"lt"</span>,</span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">diag =</span> <span class="st">"l"</span>,</span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">tl.col =</span> <span class="st">"black"</span>,</span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">tl.srt =</span> <span class="dv">45</span>,  <span class="co"># Slant the labels by 45 degrees</span></span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">tl.cex =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="th_ex03_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="final-selection" class="level3">
<h3 class="anchored" data-anchor-id="final-selection">2.5.2 Final Selection</h3>
<p>Since the variable <code>lf</code> is highly correlated with <code>lf_employed</code>, <code>lf_unemployed</code>, <code>lf_outside</code> and <code>ep_ratio</code> we can drop them from the dataframe</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>piv_full_df_mys <span class="ot">&lt;-</span> piv_full_df_mys <span class="sc">%&gt;%</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state_district =</span> <span class="fu">paste</span>(state, district, <span class="at">sep =</span> <span class="st">"-"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>state, <span class="sc">-</span>district, <span class="sc">-</span>lf_employed, <span class="sc">-</span>lf_unemployed, <span class="sc">-</span>lf_outside, <span class="sc">-</span>ep_ratio) <span class="sc">%&gt;%</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state_district) <span class="sc">%&gt;%</span></span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">causing_injury =</span> <span class="fu">mean</span>(causing_injury),</span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">murder =</span> <span class="fu">mean</span>(murder),</span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">rape =</span> <span class="fu">mean</span>(rape),</span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">robbery =</span> <span class="fu">mean</span>(robbery),</span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">break_in =</span> <span class="fu">mean</span>(break_in),</span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">theft_other =</span> <span class="fu">mean</span>(theft_other),</span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">vehicle_theft =</span> <span class="fu">mean</span>(vehicle_theft),</span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">poverty_absolute =</span> <span class="fu">mean</span>(poverty_absolute),</span>
<span id="cb156-13"><a href="#cb156-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">poverty_relative =</span> <span class="fu">mean</span>(poverty_relative),</span>
<span id="cb156-14"><a href="#cb156-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">gini =</span> <span class="fu">mean</span>(gini),</span>
<span id="cb156-15"><a href="#cb156-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">lf =</span> <span class="fu">mean</span>(lf),</span>
<span id="cb156-16"><a href="#cb156-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">p_rate =</span> <span class="fu">mean</span>(p_rate),</span>
<span id="cb156-17"><a href="#cb156-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">u_rate =</span> <span class="fu">mean</span>(u_rate))</span>
<span id="cb156-18"><a href="#cb156-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb156-19"><a href="#cb156-19" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(piv_full_df_mys)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "state_district"   "causing_injury"   "murder"           "rape"            
 [5] "robbery"          "break_in"         "theft_other"      "vehicle_theft"   
 [9] "poverty_absolute" "poverty_relative" "gini"             "lf"              
[13] "p_rate"           "u_rate"           "geometry"        </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot.mixed</span>(<span class="fu">cor</span>(<span class="fu">st_drop_geometry</span>(piv_full_df_mys)[, <span class="dv">2</span><span class="sc">:</span><span class="dv">14</span>]),</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">lower =</span> <span class="st">"ellipse"</span>, </span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">upper =</span> <span class="st">"number"</span>,</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">tl.pos =</span> <span class="st">"lt"</span>,</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">diag =</span> <span class="st">"l"</span>,</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">tl.col =</span> <span class="st">"black"</span>,</span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">tl.srt =</span> <span class="dv">45</span>,  <span class="co"># Slant the labels by 45 degrees</span></span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">tl.cex =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="th_ex03_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="analysis" class="level1">
<h1>3. Analysis</h1>
<section id="data-standardisation" class="level2">
<h2 class="anchored" data-anchor-id="data-standardisation">3.1 Data Standardisation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>cluster_rownames <span class="ot">&lt;-</span> piv_full_df_mys<span class="sc">$</span>state_district</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>mys_crime <span class="ot">&lt;-</span> piv_full_df_mys <span class="sc">%&gt;%</span> </span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>state_district) <span class="sc">%&gt;%</span> </span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_geometry</span>(<span class="cn">NULL</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">normalize</span>()</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mys_crime) <span class="ot">&lt;-</span> cluster_rownames</span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mys_crime, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 13
   causing_injury murder   rape robbery break_in theft_other vehicle_theft
            &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;         &lt;dbl&gt;
 1          0.165 0.142  0.0852  0.107     0.198      0.0453        0.123 
 2          0.508 0.282  0.112   0.366     0.404      0.242         0.721 
 3          0.468 0.241  0.102   0.155     0.150      0.108         0.308 
 4          0.316 0.385  0.127   0.113     0.287      0.145         0.408 
 5          0.198 0.332  0.0431  0.231     0.182      0.127         0.253 
 6          0.102 0.0476 0.0178  0.0782    0.203      0.0541        0.142 
 7          0.504 0.296  0.239   0.152     0.267      0.129         0.254 
 8          0.233 0.0993 0.0612  0.0727    0.170      0.0289        0.0900
 9          0.147 0      0.151   0.103     0.127      0.0204        0.267 
10          0.354 0.316  0.108   0.141     0.270      0.173         0.198 
# ℹ 6 more variables: poverty_absolute &lt;dbl&gt;, poverty_relative &lt;dbl&gt;,
#   gini &lt;dbl&gt;, lf &lt;dbl&gt;, p_rate &lt;dbl&gt;, u_rate &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="exploratory-data-analysis-eda" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis-eda">3.2 Exploratory Data Analysis (EDA)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>mys_crime_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(mys_crime)</span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>mys_crime_df, </span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span><span class="st">`</span><span class="at">causing_injury</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">20</span>, </span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color=</span><span class="st">"black"</span>, </span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill=</span><span class="st">"light blue"</span>) <span class="sc">+</span></span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Min-Max Standardisation"</span>)</span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-9"><a href="#cb161-9" aria-hidden="true" tabindex="-1"></a>s</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="th_ex03_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="hierarchical-clustering" class="level2">
<h2 class="anchored" data-anchor-id="hierarchical-clustering">3.3 Hierarchical Clustering</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>proxmat <span class="ot">&lt;-</span> <span class="fu">dist</span>(mys_crime, <span class="at">method =</span> <span class="st">'euclidean'</span>)</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>hclust_ward <span class="ot">&lt;-</span> <span class="fu">hclust</span>(proxmat, <span class="at">method =</span> <span class="st">'ward.D'</span>)</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hclust_ward, <span class="at">cex =</span> <span class="fl">0.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="th_ex03_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="st">"average"</span>, <span class="st">"single"</span>, <span class="st">"complete"</span>, <span class="st">"ward"</span>)</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(m) <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="st">"average"</span>, <span class="st">"single"</span>, <span class="st">"complete"</span>, <span class="st">"ward"</span>)</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>ac <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">agnes</span>(mys_crime, <span class="at">method =</span> x)<span class="sc">$</span>ac</span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(m, ac)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  average    single  complete      ward 
0.6937526 0.6150424 0.7545369 0.8742957 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>gap_stat <span class="ot">&lt;-</span> <span class="fu">clusGap</span>(mys_crime, </span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">FUN =</span> hcut, </span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">nstart =</span> <span class="dv">25</span>, </span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">K.max =</span> <span class="dv">15</span>, </span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">B =</span> <span class="dv">50</span>)</span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the result</span></span>
<span id="cb165-8"><a href="#cb165-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(gap_stat, <span class="at">method =</span> <span class="st">"firstmax"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Clustering Gap statistic ["clusGap"] from call:
clusGap(x = mys_crime, FUNcluster = hcut, K.max = 15, B = 50, nstart = 25)
B=50 simulated reference sets, k = 1..15; spaceH0="scaledPCA"
 --&gt; Number of clusters (method 'firstmax'): 1
          logW   E.logW       gap     SE.sim
 [1,] 2.994744 3.441452 0.4467082 0.02055871
 [2,] 2.883823 3.324927 0.4411039 0.01902068
 [3,] 2.838228 3.257166 0.4189375 0.01920334
 [4,] 2.778517 3.203484 0.4249669 0.01830208
 [5,] 2.732280 3.159342 0.4270619 0.01805385
 [6,] 2.673417 3.121157 0.4477406 0.01783116
 [7,] 2.635538 3.086293 0.4507547 0.01764343
 [8,] 2.601528 3.053767 0.4522391 0.01800592
 [9,] 2.558761 3.022885 0.4641240 0.01778018
[10,] 2.523673 2.993039 0.4693665 0.01801197
[11,] 2.494836 2.963719 0.4688834 0.01821821
[12,] 2.464340 2.935488 0.4711474 0.01823093
[13,] 2.429709 2.907984 0.4782747 0.01838659
[14,] 2.403746 2.881210 0.4774639 0.01856369
[15,] 2.376260 2.854874 0.4786140 0.01867628</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_gap_stat</span>(gap_stat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="th_ex03_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hclust_ward, <span class="at">cex =</span> <span class="fl">0.6</span>)</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rect.hclust</span>(hclust_ward, </span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">k =</span> <span class="dv">13</span>, </span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">border =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="th_ex03_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">cutree</span>(hclust_ward, <span class="at">k=</span><span class="dv">13</span>))</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>mys_sf_cluster <span class="ot">&lt;-</span> <span class="fu">cbind</span>(piv_full_df_mys, <span class="fu">as.matrix</span>(groups)) <span class="sc">%&gt;%</span></span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">CLUSTER</span><span class="st">`</span><span class="ot">=</span><span class="st">`</span><span class="at">as.matrix.groups.</span><span class="st">`</span>)</span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a><span class="fu">qtm</span>(mys_sf_cluster, <span class="st">"CLUSTER"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="th_ex03_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>dist <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(piv_full_df_mys, piv_full_df_mys)</span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>distmat <span class="ot">&lt;-</span> <span class="fu">as.dist</span>(dist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>cr <span class="ot">&lt;-</span> <span class="fu">choicealpha</span>(proxmat, distmat, <span class="at">range.alpha =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>), <span class="at">K=</span><span class="dv">13</span>, <span class="at">graph =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="th_ex03_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="th_ex03_files/figure-html/unnamed-chunk-58-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>hclust_geo <span class="ot">&lt;-</span> <span class="fu">hclustgeo</span>(proxmat, distmat, <span class="at">alpha =</span> <span class="fl">0.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">cutree</span>(hclust_geo, <span class="at">k=</span><span class="dv">13</span>))</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>mys_sf_cluster <span class="ot">&lt;-</span> <span class="fu">cbind</span>(piv_full_df_mys, <span class="fu">as.matrix</span>(groups)) <span class="sc">%&gt;%</span></span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">CLUSTER</span><span class="st">`</span><span class="ot">=</span><span class="st">`</span><span class="at">as.matrix.groups.</span><span class="st">`</span>)</span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a><span class="fu">qtm</span>(mys_sf_cluster, <span class="st">"CLUSTER"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="th_ex03_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="skater-clustering" class="level2">
<h2 class="anchored" data-anchor-id="skater-clustering">3.4 SKATER Clustering</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(piv_full_df_mys)</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 87 
Number of nonzero links: 402 
Percentage nonzero weights: 5.311138 
Average number of links: 4.62069 
1 region with no links:
17
3 disjoint connected subgraphs
Link number distribution:

 0  1  2  3  4  5  6  7  8  9 
 1  4  3 13 26 13 15  5  4  3 
4 least connected regions:
33 66 67 71 with 1 link
3 most connected regions:
10 24 48 with 9 links</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(<span class="fu">st_geometry</span>(piv_full_df_mys)))</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(piv_full_df_mys), </span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">border=</span><span class="fu">grey</span>(.<span class="dv">5</span>))</span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nb,</span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>     coords, </span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">col=</span><span class="st">"blue"</span>, </span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">add=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="th_ex03_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>components <span class="ot">&lt;-</span> <span class="fu">n.comp.nb</span>(nb)</span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(components<span class="sc">$</span>comp.id <span class="sc">==</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 17</code></pre>
</div>
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>piv_full_df_mys<span class="sc">$</span>state_district[<span class="fu">which</span>(components<span class="sc">$</span>comp.id <span class="sc">==</span> <span class="dv">2</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "KEDAH-LANGKAWI"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(components<span class="sc">$</span>comp.id <span class="sc">==</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 67 71</code></pre>
</div>
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>piv_full_df_mys<span class="sc">$</span>state_district[<span class="fu">which</span>(components<span class="sc">$</span>comp.id <span class="sc">==</span> <span class="dv">3</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "PULAU PINANG-BARAT DAYA" "PULAU PINANG-TIMUR LAUT"</code></pre>
</div>
</div>
<p>1: MainLand 2: Langkawi 3: Pulau Pinang</p>
<section id="fixing" class="level3">
<h3 class="anchored" data-anchor-id="fixing">3.3.2 Fixing</h3>
<section id="langkawi" class="level4">
<h4 class="anchored" data-anchor-id="langkawi">3.3.2.1 Langkawi</h4>
<p>Given that there are water routes to Langkawi from perlis we will add that in</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>nb[[<span class="dv">17</span>]] <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">c</span>(<span class="dv">66</span>))</span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>nb[[<span class="dv">66</span>]] <span class="ot">&lt;-</span> <span class="fu">c</span>(nb[[<span class="dv">66</span>]], <span class="fu">as.integer</span>(<span class="dv">17</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pulau-pinang" class="level4">
<h4 class="anchored" data-anchor-id="pulau-pinang">3.3.2.2 Pulau Pinang</h4>
<p>For Penang island we will be mapping by the 2 land links available 1. Timur Laut -&gt; S.P. Tengah 2. Barat Daya -&gt; S.P. Selatan</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mys_sf <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ADM1_EN<span class="sc">==</span><span class="st">"PULAU PINANG"</span>)) <span class="sc">+</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"ADM2_EN"</span>, <span class="at">size =</span> <span class="fl">0.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="th_ex03_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get indices where state_district starts with "PULAU PINANG"</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>indices_pulau_pinang <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">startsWith</span>(piv_full_df_mys<span class="sc">$</span>state_district, <span class="st">"PULAU PINANG"</span>))</span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the corresponding state_district values</span></span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a>indices_pulau_pinang</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 67 68 69 70 71</code></pre>
</div>
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>piv_full_df_mys<span class="sc">$</span>state_district[indices_pulau_pinang]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "PULAU PINANG-BARAT DAYA"  "PULAU PINANG-S.P. TENGAH"
[3] "PULAU PINANG-S.P. UTARA"  "PULAU PINANG-S.P.SELATAN"
[5] "PULAU PINANG-TIMUR LAUT" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fixing for BARAT DAYA</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>nb[[<span class="dv">67</span>]] <span class="ot">&lt;-</span> <span class="fu">c</span>(nb[[<span class="dv">67</span>]], <span class="fu">as.integer</span>(<span class="dv">68</span>))</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>nb[[<span class="dv">68</span>]] <span class="ot">&lt;-</span> <span class="fu">c</span>(nb[[<span class="dv">68</span>]], <span class="fu">as.integer</span>(<span class="dv">67</span>))</span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fixing for TIMUR LAUT</span></span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>nb[[<span class="dv">71</span>]] <span class="ot">&lt;-</span> <span class="fu">c</span>(nb[[<span class="dv">71</span>]], <span class="fu">as.integer</span>(<span class="dv">70</span>))</span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a>nb[[<span class="dv">70</span>]] <span class="ot">&lt;-</span> <span class="fu">c</span>(nb[[<span class="dv">70</span>]], <span class="fu">as.integer</span>(<span class="dv">71</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(<span class="fu">st_geometry</span>(piv_full_df_mys)))</span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(piv_full_df_mys), </span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">border=</span><span class="fu">grey</span>(.<span class="dv">5</span>))</span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nb,</span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>     coords, </span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">col=</span><span class="st">"blue"</span>, </span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">add=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="th_ex03_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="compute-mst" class="level3">
<h3 class="anchored" data-anchor-id="compute-mst">3.3.3 Compute MST</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>lcosts <span class="ot">&lt;-</span> <span class="fu">nbcosts</span>(nb, mys_crime)</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>mys_crime.w <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb, </span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>                   lcosts, </span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">style=</span><span class="st">"B"</span>)</span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mys_crime.w)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 87 
Number of nonzero links: 408 
Percentage nonzero weights: 5.390408 
Average number of links: 4.689655 
3 disjoint connected subgraphs
Link number distribution:

 1  2  3  4  5  6  7  8  9 
 2  6 12 26 14 15  5  4  3 
2 least connected regions:
17 33 with 1 link
3 most connected regions:
10 24 48 with 9 links

Weights style: B 
Weights constants summary:
   n   nn       S0       S1       S2
B 87 7569 307.3487 522.5748 5498.055</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>mys_crime.mst <span class="ot">&lt;-</span> <span class="fu">mstree</span>(mys_crime.w)</span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mys_crime.mst)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]      [,3]
[1,]   22   19 0.6437534
[2,]   19   20 0.3112274
[3,]   20   15 0.4035963
[4,]   15   66 0.4238329
[5,]   20   18 0.5221493
[6,]   19   13 0.6941269</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(piv_full_df_mys), </span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">border=</span><span class="fu">gray</span>(.<span class="dv">5</span>))</span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.mst</span>(mys_crime.mst, </span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a>         coords, </span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">col=</span><span class="st">"blue"</span>, </span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">cex.lab=</span><span class="fl">0.7</span>, </span>
<span id="cb197-7"><a href="#cb197-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">cex.circles=</span><span class="fl">0.005</span>, </span>
<span id="cb197-8"><a href="#cb197-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">add=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="th_ex03_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="compute-clusters-skater" class="level3">
<h3 class="anchored" data-anchor-id="compute-clusters-skater">3.3.4 Compute clusters (SKATER)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>clust <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">skater</span>(<span class="at">edges =</span> mys_crime.mst[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], </span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> mys_crime, </span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">method =</span> <span class="st">"euclidean"</span>, </span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ncuts =</span> <span class="dv">12</span>)</span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(clust)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 8
 $ groups      : num [1:87] 3 12 3 3 3 3 3 3 3 3 ...
 $ edges.groups:List of 13
  ..$ :List of 3
  .. ..$ node: num [1:15] 69 19 14 22 16 20 70 71 15 21 ...
  .. ..$ edge: num [1:14, 1:3] 19 19 19 16 22 14 20 70 69 71 ...
  .. ..$ ssw : num 7.64
  ..$ :List of 3
  .. ..$ node: num [1:10] 73 75 78 74 41 77 33 79 80 43
  .. ..$ edge: num [1:9, 1:3] 75 41 78 78 73 41 75 74 78 77 ...
  .. ..$ ssw : num 5.86
  ..$ :List of 3
  .. ..$ node: num [1:15] 4 35 42 36 6 10 3 1 8 40 ...
  .. ..$ edge: num [1:14, 1:3] 35 42 36 6 3 10 1 8 36 10 ...
  .. ..$ ssw : num 7.01
  ..$ :List of 3
  .. ..$ node: num [1:17] 55 52 54 84 82 49 51 46 39 83 ...
  .. ..$ edge: num [1:16, 1:3] 52 54 84 51 82 49 46 39 83 55 ...
  .. ..$ ssw : num 7.39
  ..$ :List of 3
  .. ..$ node: num [1:11] 56 63 58 61 62 59 64 57 12 65 ...
  .. ..$ edge: num [1:10, 1:3] 63 58 62 61 63 59 58 56 64 61 ...
  .. ..$ ssw : num 4.81
  ..$ :List of 3
  .. ..$ node: num 76
  .. ..$ edge: num[0 , 1:3] 
  .. ..$ ssw : num 0
  ..$ :List of 3
  .. ..$ node: num 17
  .. ..$ edge: num[0 , 1:3] 
  .. ..$ ssw : num 0
  ..$ :List of 3
  .. ..$ node: num [1:11] 25 31 26 30 29 28 23 24 81 27 ...
  .. ..$ edge: num [1:10, 1:3] 25 31 30 29 31 23 26 28 25 29 ...
  .. ..$ ssw : num 5.43
  ..$ :List of 3
  .. ..$ node: num 47
  .. ..$ edge: num[0 , 1:3] 
  .. ..$ ssw : num 0
  ..$ :List of 3
  .. ..$ node: num 45
  .. ..$ edge: num[0 , 1:3] 
  .. ..$ ssw : num 0
  ..$ :List of 3
  .. ..$ node: num [1:2] 72 34
  .. ..$ edge: num [1, 1:3] 72 34 0.775
  .. ..$ ssw : num 0.775
  ..$ :List of 3
  .. ..$ node: num 2
  .. ..$ edge: num[0 , 1:3] 
  .. ..$ ssw : num 0
  ..$ :List of 3
  .. ..$ node: num 68
  .. ..$ edge: num[0 , 1:3] 
  .. ..$ ssw : num 0
 $ not.prune   : NULL
 $ candidates  : int [1:13] 1 2 3 4 5 6 7 8 9 10 ...
 $ ssto        : num 56.4
 $ ssw         : num [1:13] 56.4 53.9 52.2 50.4 48.4 ...
 $ crit        : num [1:2] 1 Inf
 $ vec.crit    : num [1:87] 1 1 1 1 1 1 1 1 1 1 ...
 - attr(*, "class")= chr "skater"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>ccs <span class="ot">&lt;-</span> clust<span class="sc">$</span>groups</span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>ccs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  3 12  3  3  3  3  3  3  3  3  1  5  1  1  1  1  7  1  1  1  1  1  8  8  8
[26]  8  8  8  8  8  8  8  2 11  3  3  3  4  4  3  2  3  2  3 10  4  9  4  4  4
[51]  4  4  4  4  4  5  5  5  5  5  5  5  5  5  5  1  1 13  1  1  1 11  2  2  2
[76]  6  2  2  2  2  8  4  4  4  4  4  4</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(piv_full_df_mys), </span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">border=</span><span class="fu">gray</span>(.<span class="dv">5</span>))</span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(clust, </span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a>     coords, </span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex.lab=</span>.<span class="dv">7</span>,</span>
<span id="cb202-6"><a href="#cb202-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex.circles=</span><span class="fl">0.005</span>, </span>
<span id="cb202-7"><a href="#cb202-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">add=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="th_ex03_files/figure-html/unnamed-chunk-74-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="visualizing-clusters" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-clusters">3.3.5 Visualizing Clusters</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>groups_mat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(clust<span class="sc">$</span>groups)</span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>crime_mys_spatialcluster <span class="ot">&lt;-</span> <span class="fu">cbind</span>(piv_full_df_mys, <span class="fu">as.factor</span>(groups_mat)) <span class="sc">%&gt;%</span></span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">SP_CLUSTER</span><span class="st">`</span><span class="ot">=</span><span class="st">`</span><span class="at">as.factor.groups_mat.</span><span class="st">`</span>)</span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a><span class="fu">qtm</span>(crime_mys_spatialcluster, <span class="st">"SP_CLUSTER"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="th_ex03_files/figure-html/unnamed-chunk-75-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="intepretation" class="level1">
<h1>4. Intepretation</h1>
</section>
<section id="story-board" class="level1">
<h1>5. Story Board</h1>
<section id="layout" class="level2">
<h2 class="anchored" data-anchor-id="layout">5.1 Layout</h2>
</section>
<section id="parameters" class="level2">
<h2 class="anchored" data-anchor-id="parameters">5.2 Parameters</h2>
<p>(Story Board)[https://giniceseah.netlify.app/posts/2021-07-31-storyboard/]</p>
</section>
</section>
<section id="reflection" class="level1">
<h1>6. Reflection</h1>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>