{
  "hash": "10e8f01da793dfd825249734550fbdeb",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take-home Exercise 2\"\nauthor: \"Jeffery Lau\"\ndate: 09-07-2024\ndate-modified: \"last-modified\"\ndescription: |\n  In this exercise, We will be analyzing armed conflict data in Myanmar, using spatial point pattern analysis to understand the distribution and relationships between conflict events. We'll also create maps to visualize the results and interpret the spatial patterns.\ncategories:\n  - Take-home\nformat:\n  html:\n    toc: true\nexecute: \n  eval: true\n  echo: true\n  warning: false\n  freeze: true\n---\n\n\n# 1. Introduction\n\n## 1.1 Context\n\nIn 2024 armed conflict continues to be a devastating global issue, with millions of people affected each year. Recent years have seen a surge in conflicts, driven by factors such as political instability, regional tensions, and resource scarcity. Myanmar, in particular, has experienced significant armed conflict in recent years, including the 2021 military coup and subsequent violence.\n\nTODO: Lit review\n\n## 1.2 Objectives\n\n1.  Analyze the spatial distribution of armed conflict events in Myanmar.\n2.  Identify patterns and trends in the temporal distribution of conflict events.\n3.  Explore the relationship between conflict events and geographic features (e.g., administrative boundaries, natural resources).\n4.  Identify potential hotspots of conflict activity.\n5.  Provide insights for policymakers and humanitarian organizations working to address the conflict in Myanmar.\n\n# 2. Setup\n\n## 2.1 Loading Packages\n\nIn this project we will be using the following packages:\n\n-   **`tmap`:** A package for creating thematic maps in R. It provides a simple and flexible interface for customizing maps and exporting them in various formats.\n\n-   **`sf`:** A package for simple feature data, which is a modern standard for representing geographic features. It provides efficient data structures and functions for spatial operations.\n\n-   **`raster`:** A package for working with raster data, such as images and digital elevation models. It offers tools for reading, writing, manipulating, and analyzing raster data.\n\n-   **`spatstat`:** A package for spatial point pattern analysis. It provides functions for analyzing the distribution and relationships between points in a study area.\n\n-   **`maptools`:** A package for reading and writing various spatial data formats, including shapefiles and KML. It also provides tools for converting between different spatial data structures.\n\n-   **`sp`:** A package for spatial data in R. It provides classes and functions for representing and manipulating spatial data, such as points, lines, and polygons.\n\n-   **`tidyverse`:** A collection of R packages designed for data manipulation, visualization, and analysis. It includes packages like dplyr, ggplot2, and tidyr, which are commonly used in data science workflows.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tmap, sf, raster, spatstat, maptools, sp, tidyverse)\n```\n:::\n\n\n## 2.2 Loading Data\n\nThe dataset used in this analysis is sourced from the Armed Conflict Location & Event Data (ACLED) database. It contains information on various types of armed conflict events, including Battles, Explosion/Remote violence, Strategic developments, Protest, Riots, and Violence against civilians. The data covers the period from January 2021 to June 2024 and provides specific details such as event date, location coordinates, actor information, and more.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Read CSV files\nacled_2021_23 <- read_csv(\"data/2021-2023-Myanmar.csv\")\nacled_2024 <- read_csv(\"data/2024-Myanmar.csv\")\n```\n:::\n\n\nNext we load [Myanmar Boundary](https://data.humdata.org/dataset/mimu-geonode-myanmar-state-and-region-boundaries-mimu?) from Humanitarian Data Exchange - Get demographics - Get town center\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Read Myanmar Boundary\nmym_sf <- st_read(dsn = \"data/geospatial\", \n                      layer = \"mmr_polbnda_adm1_250k_mimu_1\") %>%\n              st_transform(crs = 32647)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `mmr_polbnda_adm1_250k_mimu_1' from data source \n  `/Users/jeffery/Projects/Y4S1/IS415/S0methingSimple/IS415-GAA/take-home_ex/ex01/data/geospatial' \n  using driver `ESRI Shapefile'\nSimple feature collection with 15 features and 6 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 92.1721 ymin: 9.696844 xmax: 101.17 ymax: 28.54554\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n:::\n\n\n# 3. Data Wrangling and Exploration\n\n## 3.1 CRS Projection & Formatting\n\nThe initial step involved reading the ACLED data into R and converting it into a sf data frame, specifying the longitude and latitude columns as coordinates and the WGS84 coordinate reference system (CRS). To ensure consistency with the administrative boundary data, the CRS was projected to EPSG:32647.\n\nAdditional data cleaning and preparation steps were performed, including handling missing values and formatting dates.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Combine data frames\nacled_combined <- bind_rows(acled_2021_23, acled_2024)\n\n# Convert to SF object\nacled_full_sf <- acled_combined %>%\n  st_as_sf(coords = c(\"longitude\", \"latitude\"), crs = 4326) %>%\n  st_transform(crs = 32647) %>%\n  mutate(event_date = dmy(event_date))\n```\n:::\n\n\n## 3.2 Data Cleaning\n\nNext data cleaning\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Check for null values in key columns\nna_count <- acled_full_sf %>%\n  summarise(na_geometry = sum(is.na(geometry)),\n            na_event_date = sum(is.na(event_date)))\n\n# Check for null values in key columns\nduplicate_count <- acled_full_sf %>%\n  summarise(duplicate_event_id = sum(duplicated(event_id_cnty)),\n            duplicate_geometry = sum(duplicated(geometry)))\n\nprint(na_count)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 1 feature and 2 fields\nGeometry type: MULTIPOINT\nDimension:     XY\nBounding box:  xmin: -208804.4 ymin: 1103500 xmax: 640934.5 ymax: 3042960\nProjected CRS: WGS 84 / UTM zone 47N\n# A tibble: 1 × 3\n  na_geometry na_event_date                                             geometry\n        <int>         <int>                                     <MULTIPOINT [m]>\n1           0             0 ((-208804.4 2357274), (-207135 2358896), (-206931.7…\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(duplicate_count)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 1 feature and 2 fields\nGeometry type: MULTIPOINT\nDimension:     XY\nBounding box:  xmin: -208804.4 ymin: 1103500 xmax: 640934.5 ymax: 3042960\nProjected CRS: WGS 84 / UTM zone 47N\n# A tibble: 1 × 3\n  duplicate_event_id duplicate_geometry                                 geometry\n               <int>              <int>                         <MULTIPOINT [m]>\n1                  0              44101 ((-208804.4 2357274), (-207135 2358896)…\n```\n\n\n:::\n:::\n\n\n## 3.3 Joining Dataframes\n\n\n::: {.cell}\n\n```{.r .cell-code}\nacled_sf <- st_join(acled_full_sf, mym_sf) %>%\n  select(event_date, event_type, fatalities, ST, admin1, geometry) %>%\n  rename(state = ST)\n\nprint(acled_sf %>% filter(is.na(state)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 7 features and 5 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: -169820.9 ymin: 1306490 xmax: 479880.3 ymax: 2310507\nProjected CRS: WGS 84 / UTM zone 47N\n# A tibble: 7 × 6\n  event_date event_type        fatalities state admin1            geometry\n* <date>     <chr>                  <dbl> <chr> <chr>          <POINT [m]>\n1 2023-09-21 Violence against…          0 <NA>  Rakhi… (-169820.9 2310507)\n2 2023-08-31 Violence against…          0 <NA>  Tanin…  (479880.3 1306490)\n3 2023-05-13 Battles                    3 <NA>  Kayin   (464878.7 1805058)\n4 2023-05-12 Battles                    2 <NA>  Kayin   (464878.7 1805058)\n5 2023-05-11 Battles                    0 <NA>  Kayin   (464878.7 1805058)\n6 2022-07-23 Strategic develo…          0 <NA>  Ayeya…  (15981.32 1894241)\n7 2021-03-22 Violence against…          0 <NA>  Rakhi… (-169820.9 2310507)\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nacled_sf <- acled_sf %>%\n  mutate(state = ifelse(is.na(state), admin1, state)) %>%\n  select(-admin1)\n\nsummary(acled_sf)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   event_date          event_type          fatalities         state          \n Min.   :2021-01-01   Length:51553       Min.   :  0.000   Length:51553      \n 1st Qu.:2021-10-23   Class :character   1st Qu.:  0.000   Class :character  \n Median :2022-07-28   Mode  :character   Median :  0.000   Mode  :character  \n Mean   :2022-08-25                      Mean   :  1.062                     \n 3rd Qu.:2023-07-05                      3rd Qu.:  1.000                     \n Max.   :2024-06-30                      Max.   :201.000                     \n          geometry    \n POINT        :51553  \n epsg:32647   :    0  \n +proj=utm ...:    0  \n                      \n                      \n                      \n```\n\n\n:::\n:::\n\n\n## 3.3 Exploratory Data Analysis\n\nThe following is an initial plot of the point events on boundary and region map of Myanmar.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mym_sf) + tm_polygons() +\n  tm_shape(acled_sf) + tm_dots()\n```\n\n::: {.cell-output-display}\n![](th_ex01_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(acled_sf, aes(x = event_date, fill = event_type)) +\n  geom_histogram(binwidth = 15, position = \"stack\") +\n  scale_fill_brewer(palette = \"Spectral\") +\n  labs(title = \"Stacked Histogram of Event Dates by Event Type\",\n       x = \"Event Date\",\n       y = \"Count\")\n```\n\n::: {.cell-output-display}\n![](th_ex01_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nacled_by_region <- acled_sf %>%\n  group_by(state) %>%\n  summarize(event_count = n())\n\n# Join the event count data with the region polygon data\njoined_data <- st_join(mym_sf, acled_by_region)\n\ntm_shape(joined_data) +\n  tm_polygons(col = \"event_count\", style = \"jenks\", palette = \"YlOrRd\") +\n  tm_layout(title = \"Event Count by Region\")\n```\n\n::: {.cell-output-display}\n![](th_ex01_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(acled_sf, aes(x = event_type, y = fatalities)) +\n  geom_point(color = \"darkorange\") +\n  labs(title = \"Relationship Between Fatalities and Event Type\",\n       x = \"Event Type\",\n       y = \"Fatalities\") +\n  coord_flip() +\n  theme(axis.text.y = element_text(angle = 45, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](th_ex01_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nevent_type_counts <- acled_sf %>%\n  count(event_type)\n\nggplot(event_type_counts, aes(x = \"\", y = n, fill = event_type)) +\n  geom_bar(stat = \"identity\", color = \"white\") +\n  geom_text(aes(label = n), position = position_stack(vjust = 0.5)) +\n  coord_polar(theta = \"y\") +\n  scale_fill_brewer(palette = \"Spectral\") +\n  labs(title = \"Distribution of Event Types\")  +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](th_ex01_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n# 4. Spatial Point Pattern Analysis\n\n## 4.1 Preparation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nacled_ppp <- as.ppp(acled_sf)\nacled_ppp\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nMarked planar point pattern: 51553 points\nmarks are dates, of class 'Date'\nwindow: rectangle = [-208804.4, 640934.5] x [1103500.1, 3042960.3] units\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmym_outer_sf <- mym_sf %>% # select the central parts\n  st_buffer(0.5) %>% # make a buffer of half a meter around all parts (to avoid slivers)\n  st_union()\n\nmym_owin <- as.owin(mym_outer_sf)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nacled_ppp <- acled_ppp[mym_owin]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nacled_ppp_km <- rescale(acled_ppp, 1000, \"km\")\n\nplot(acled_ppp_km)\n```\n:::\n\n\n## 4.2 First Order Analysis\n\n### 4.2.1 Compute Kernel Density\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# acled_ppp_km_bw_ppl <- bw.ppl(acled_ppp_km) # 2.325089\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nacled_ppp_kde = density(acled_ppp_km, \n                        sigma = 2.3, \n                        edge = FALSE, \n                        kernel = \"gaussian\")\nplot(acled_ppp_kde)\n```\n:::\n\n\n### Questions\n\nAnalytics - How to use analysis results such as clustering to interpret? should we include other dimension of data - How to work on the 10 quarters meaningfully (For spatial point pattern analysis) - Pick region to do 2nd order analysis\n\nTechnical - How to speed up KDE analysis with 51k record? sampling - How to deal with the 7 points outside of the region\n\n-   Group the ACLED data by quarter and calculate KDE surfaces using `st_density`.\n\n-   Experiment with different bandwidths and kernel functions to find the most appropriate settings.\n\n-   Create separate KDE layers for each quarter.\\\n\n## 4.3 Second Order Analysis\n\n\n::: {.cell}\n\n:::\n\n\n-   **Calculate Spatial Autocorrelation Measures:**\n\n    -   Use functions from `spatstat` or other spatial analysis packages to calculate measures like Moran's I or Geary's C.\n\n    -   Assess whether conflict events are clustered, dispersed, or randomly distributed.\n\n    -   Consider using edge correction methods to account for boundary effects\n\n    **Analyze Ripley's K-function:**\n\n    -   Calculate Ripley's K-function to measure the intensity of points within a given distance of an existing point.\n\n    -   Interpret the results to identify clustering or dispersion patterns.\n\n# 5. Spatial-Temporal Analysis\n\n-   **Create Quarterly Spatio-Temporal KDE Layers:**\n\n    -   Combine the temporal dimension (quarter) with the spatial coordinates to create spatio-temporal KDE surfaces\n\n    -   Explore different methods for incorporating time into the KDE calculation\n\n    **Analyze Spatio-Temporal Autocorrelation:**\n\n    -   Use spatio-temporal autocorrelation measures to assess the spatial and temporal relationships between conflict events.\n\n    -   Consider using methods like spatio-temporal G-functions or spatio-temporal Moran's I.\n\n# 6. Interpretation\n",
    "supporting": [
      "th_ex01_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}